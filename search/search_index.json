{"config":{"indexing":"full","lang":["pt"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Despregadura en AWS dunha arquitectura HA el\u00e1stica de 2 capas Usando os servizos de AWS, nesta pr\u00e1ctica vamos despregar unha arquitectura de d\u00faas capas que proporcione alta dispo\u00f1ibilidade, escalabilidade e seguranza para un servizo de xesti\u00f3n de tarefas pendentes. A escalabilidade e resiliencia da arquitectura comprobarase realizando probas de carga e de inxecci\u00f3n de fallas. Imaxe: arquitectura de d\u00faas capas que se vai despregar nesta pr\u00e1ctica indicando os servizos AWS que se van empregar. Unha arquitectura de d\u00faas capas \u00e9 un modelo cliente-servidor de arquitectura software que divide a aplicaci\u00f3n en d\u00faas capas l\u00f3xicas: a capa que cont\u00e9n a l\u00f3xica da aplicaci\u00f3n e que xera o contido visualizado polos clientes, a capa de almacenamento de datos. A divisi\u00f3n dunha aplicaci\u00f3n en capas aporta modularidade \u00e1 aplicaci\u00f3n, permitindo xestionar cada capa de maneira independente e configurar a escalabilidade, a HA e a seguranza do xeito m\u00e1is adecuado a cada capa. A aplicaci\u00f3n que vamos utilizar como exemplo \u00e9 unha aplicaci\u00f3n para un contorno LAMP, cun frontend escrito en PHP e un backend compat\u00edbel con MySQL, para a xesti\u00f3n de tarefas pendentes . Imaxe: aplicaci\u00f3n para a xesti\u00f3n de tarefas pendentes que usaremos como exemplo. Nota A pr\u00e1ctica est\u00e1 enfocada principalmente aos aspectos relacionados coa alta dispo\u00f1ibilidade e a elasticidade da arquitectura. Alg\u00fans elementos que son habituais nestas arquitecturas que te\u00f1en a ver co rendemento (p.ex. uso dunha cach\u00e9 na capa de datos) ou a seguranza (p.ex. configuraci\u00f3n do HTTPS) deixaronse fora por non facela demasiado longa. Tampouco se trata a automatizaci\u00f3n da despregadura con ferramentas IaC ( Infrastructure as Code ) como CloudFormation ou Terraform . Licenza Despregadura en AWS dunha arquitectura HA el\u00e1stica de 2 capas de Xo\u00e1n C. Pardo ten unha licenza Creative Commons Reco\u00f1ecemento-Non comercial 4.0 Internacional .","title":"Despregadura en AWS dunha arquitectura HA el\u00e1stica de 2 capas"},{"location":"#despregadura-en-aws-dunha-arquitectura-ha-elastica-de-2-capas","text":"Usando os servizos de AWS, nesta pr\u00e1ctica vamos despregar unha arquitectura de d\u00faas capas que proporcione alta dispo\u00f1ibilidade, escalabilidade e seguranza para un servizo de xesti\u00f3n de tarefas pendentes. A escalabilidade e resiliencia da arquitectura comprobarase realizando probas de carga e de inxecci\u00f3n de fallas. Imaxe: arquitectura de d\u00faas capas que se vai despregar nesta pr\u00e1ctica indicando os servizos AWS que se van empregar. Unha arquitectura de d\u00faas capas \u00e9 un modelo cliente-servidor de arquitectura software que divide a aplicaci\u00f3n en d\u00faas capas l\u00f3xicas: a capa que cont\u00e9n a l\u00f3xica da aplicaci\u00f3n e que xera o contido visualizado polos clientes, a capa de almacenamento de datos. A divisi\u00f3n dunha aplicaci\u00f3n en capas aporta modularidade \u00e1 aplicaci\u00f3n, permitindo xestionar cada capa de maneira independente e configurar a escalabilidade, a HA e a seguranza do xeito m\u00e1is adecuado a cada capa. A aplicaci\u00f3n que vamos utilizar como exemplo \u00e9 unha aplicaci\u00f3n para un contorno LAMP, cun frontend escrito en PHP e un backend compat\u00edbel con MySQL, para a xesti\u00f3n de tarefas pendentes . Imaxe: aplicaci\u00f3n para a xesti\u00f3n de tarefas pendentes que usaremos como exemplo. Nota A pr\u00e1ctica est\u00e1 enfocada principalmente aos aspectos relacionados coa alta dispo\u00f1ibilidade e a elasticidade da arquitectura. Alg\u00fans elementos que son habituais nestas arquitecturas que te\u00f1en a ver co rendemento (p.ex. uso dunha cach\u00e9 na capa de datos) ou a seguranza (p.ex. configuraci\u00f3n do HTTPS) deixaronse fora por non facela demasiado longa. Tampouco se trata a automatizaci\u00f3n da despregadura con ferramentas IaC ( Infrastructure as Code ) como CloudFormation ou Terraform .","title":"Despregadura en AWS dunha arquitectura HA el\u00e1stica de 2 capas"},{"location":"#licenza","text":"Despregadura en AWS dunha arquitectura HA el\u00e1stica de 2 capas de Xo\u00e1n C. Pardo ten unha licenza Creative Commons Reco\u00f1ecemento-Non comercial 4.0 Internacional .","title":"Licenza"},{"location":"ami/","text":"Paso 4: Configuraci\u00f3n da aplicaci\u00f3n O seguinte paso vai ser a configuraci\u00f3n da aplicaci\u00f3n que usaremos na nosa arquitectura. En concreto, vamos facer o seguinte: Iniciar unha inst\u00e2ncia EC2 na que faremos a configuraci\u00f3n da aplicaci\u00f3n. Configurar o acceso \u00e1 capa de datos desde a aplicaci\u00f3n. Crear a BD que almacenar\u00e1 os datos da aplicaci\u00f3n. Crear unha AMI a partir da instancia configurada. Inicia unha instancia EC2 Desde a consola do servizo EC2, inicia unha instancia coa configuraci\u00f3n seguinte: Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-app-server AMI: Amazon Linux 2023 Tipo de instancia: t2.micro Par de chaves: escolle a opci\u00f3n de continuar sen un par de chaves. Vamos usar o System Session Manager para conectarnos \u00e1 instancia. Rede: escolle a VPC que creaches para a arquitectura, unha das subredes privadas que se crearon para a capa de aplicaci\u00f3n e o grupo de seguranza da capa de aplicaci\u00f3n. Detalles avanzados: escolle o perfil de instancia IAM LabInstanceProfile , que xa est\u00e1 predefinido no laboratorio de AWS Academy. Nota Se se che pregunta pola creaci\u00f3n dun par de chaves durante o lanzamento da instancia, escolle a opci\u00f3n de continuar sen crear ning\u00fan. Imaxe: propiedades da instancia EC2. Conectate \u00e1 instancia Para conectarte \u00e1 instancia usando o System Session Manager fai o seguinte: Coa instancia seleccionada na consola de EC2, escolle a opci\u00f3n Conectar . No asistente cos m\u00e9todos de conexi\u00f3n, escolle a aba do Administrador de Sesi\u00f3ns e preme no bot\u00f3n Conectar . Abrirase no teu navegador un terminal cunha sesi\u00f3n SSH na instancia. Imaxe: conexi\u00f3n \u00e1 instancia EC2. Nota Se aparece unha mensaxe dicindo que non \u00e9 pos\u00edbel realizar a conexi\u00f3n, revisa que a instancia te\u00f1a asociado o rol IAM LabRole (\u00e9 dicir, que escolleras o perfil de instancia IAM LabInstanceProfile ao iniciala) e que o seu tr\u00e1fico estexa sendo encami\u00f1ado para os gateways NAT (\u00e9 dicir, que a iniciaras nunha das subredes privadas da capa de aplicaci\u00f3n). O usuario co que se inicia a sesi\u00f3n \u00e9 ssm-user por defecto. A\u00ednda que poderiamos facer a configuraci\u00f3n desde esta conta, vamos configurar a aplicaci\u00f3n desde a do usuario ec2-user . sudo -iu ec2-user Comproba que te\u00f1as conexi\u00f3n a Internet a trav\u00e9s dos gateways NAT facendo ping , por exemplo, aos servidores DNS do Google. ping 8.8.8.8 Nota Se non houbera conexi\u00f3n, revisa que na configuraci\u00f3n das t\u00e1boas de rutas asociadas \u00e1 subrede na que lanzaches a instancia, o tr\u00e1fico estexa sendo encami\u00f1ado cara ao gateway NAT. Comproba a conexi\u00f3n coa BD Instala o cliente MySQL. sudo dnf update -y wget https://dev.mysql.com/get/mysql80-community-release-el9-5.noarch.rpm sudo dnf install mysql80-community-release-el9-5.noarch.rpm sudo dnf install -y mysql-community-client Con\u00e9ctate ao cluster de BD Aurora. Usa o endpoint da instancia de escritura que copiaches ao configurar o cluster e a se\u00f1a que configuraras para o usuario admin . mysql -h <endpoint_da_instancia_de_escritura> -u admin -p Nota Se non consegues conectar, revisa o endpoint , a se\u00f1a, que a instancia estexa nunha subrede privada da capa de aplicaci\u00f3n e te\u00f1a asignado o grupo de seguranza desa capa, que a BD te\u00f1a asignado o grupo de seguranza da capa de datos e que o grupo de seguranza da capa de datos estexa correctamente configurado. Comproba as BD que hai. F\u00edxate en que non hai ningunha chamada tasks . SHOW DATABASES; Pecha a conexi\u00f3n co comando exit . Configura a aplicaci\u00f3n Instala Apache, git, PHP e as extensi\u00f3ns PHP para MySQL. sudo dnf install -y httpd git php php-pdo php-mysqli Descarga a aplicaci\u00f3n. sudo git clone https://github.com/gei-eii/todo-php /var/www/html/ Crea un directorio para a configuraci\u00f3n e move o ficheiro de configuraci\u00f3n dentro del. sudo mkdir /var/www/configs && \\ sudo mv /var/www/html/config.php /var/www/configs/ Cambia o propietario ao usuario apache , que \u00e9 o que se usa para executar o servidor web. sudo chown -R apache:apache /var/www/configs Edita o ficheiro /var/www/configs/config.php cos datos seguintes: host : o endpoint da instancia de escritura que copiaches ao configurar o cluster de BD Aurora. username : admin password : a se\u00f1a que configuraras para o usuario admin ao crear o cluster de BD Aurora. Importante Isto non \u00e9 considerado como unha boa pr\u00e1ctica . AWS recomenda usar o servizo Secrets Manager para gardar esta informaci\u00f3n de maneira segura. Fac\u00e9molo as\u00ed por simplificar a pr\u00e1ctica. Activa e inicia Apache. sudo systemctl enable --now httpd Accede \u00e1 p\u00e1xina principal. Se a configuraci\u00f3n se fixo correctamente, devolver\u00e1 a p\u00e1xina principal da aplicaci\u00f3n precedida dun erro indicando que non se atopou a BD tasks . curl localhost Crea a BD Crea a BD da aplicaci\u00f3n executando o script install.php . cd /var/www/html/ && \\ php install.php Imaxe: sa\u00edda do comando que crea a BD. Con\u00e9ctate de novo ao cluster de BD Aurora e comproba co comando SHOW DATABASES; que agora hai unha nova BD chamada tasks . Repite o acceso \u00e1 p\u00e1xina. Agora, como parte da sa\u00edda, am\u00f3sase o DNS privado da instancia e o endpoint do cluster de BD curl localhost | grep host Imaxe: sa\u00edda do comando curl. Crea a AMI Vamos crear unha AMI da inst\u00e1ncia de aplicaci\u00f3n que acabamos de configurar para usala posteriormente cando configuremos o balanceador de carga e o grupo de autoescalamento na capa de aplicaci\u00f3n. No men\u00fa de acci\u00f3ns da instancia, submen\u00fa Imaxes e modelos , escolle a opci\u00f3n Crear imaxe para crear unha AMI coas opci\u00f3ns seguintes: Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-app-ami Descrici\u00f3n: escribe unha descrici\u00f3n para a t\u00faa AMI. Imaxe: AMI que cont\u00e9n a aplicaci\u00f3n xa configurada. Xa podes terminar a instancia EC2 que usaches para configurar a aplicaci\u00f3n.","title":"Paso 4: Configuraci\u00f3n da aplicaci\u00f3n"},{"location":"ami/#paso-4-configuracion-da-aplicacion","text":"O seguinte paso vai ser a configuraci\u00f3n da aplicaci\u00f3n que usaremos na nosa arquitectura. En concreto, vamos facer o seguinte: Iniciar unha inst\u00e2ncia EC2 na que faremos a configuraci\u00f3n da aplicaci\u00f3n. Configurar o acceso \u00e1 capa de datos desde a aplicaci\u00f3n. Crear a BD que almacenar\u00e1 os datos da aplicaci\u00f3n. Crear unha AMI a partir da instancia configurada.","title":"Paso 4: Configuraci\u00f3n da aplicaci\u00f3n"},{"location":"ami/#inicia-unha-instancia-ec2","text":"Desde a consola do servizo EC2, inicia unha instancia coa configuraci\u00f3n seguinte: Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-app-server AMI: Amazon Linux 2023 Tipo de instancia: t2.micro Par de chaves: escolle a opci\u00f3n de continuar sen un par de chaves. Vamos usar o System Session Manager para conectarnos \u00e1 instancia. Rede: escolle a VPC que creaches para a arquitectura, unha das subredes privadas que se crearon para a capa de aplicaci\u00f3n e o grupo de seguranza da capa de aplicaci\u00f3n. Detalles avanzados: escolle o perfil de instancia IAM LabInstanceProfile , que xa est\u00e1 predefinido no laboratorio de AWS Academy. Nota Se se che pregunta pola creaci\u00f3n dun par de chaves durante o lanzamento da instancia, escolle a opci\u00f3n de continuar sen crear ning\u00fan. Imaxe: propiedades da instancia EC2.","title":"Inicia unha instancia EC2"},{"location":"ami/#conectate-a-instancia","text":"Para conectarte \u00e1 instancia usando o System Session Manager fai o seguinte: Coa instancia seleccionada na consola de EC2, escolle a opci\u00f3n Conectar . No asistente cos m\u00e9todos de conexi\u00f3n, escolle a aba do Administrador de Sesi\u00f3ns e preme no bot\u00f3n Conectar . Abrirase no teu navegador un terminal cunha sesi\u00f3n SSH na instancia. Imaxe: conexi\u00f3n \u00e1 instancia EC2. Nota Se aparece unha mensaxe dicindo que non \u00e9 pos\u00edbel realizar a conexi\u00f3n, revisa que a instancia te\u00f1a asociado o rol IAM LabRole (\u00e9 dicir, que escolleras o perfil de instancia IAM LabInstanceProfile ao iniciala) e que o seu tr\u00e1fico estexa sendo encami\u00f1ado para os gateways NAT (\u00e9 dicir, que a iniciaras nunha das subredes privadas da capa de aplicaci\u00f3n). O usuario co que se inicia a sesi\u00f3n \u00e9 ssm-user por defecto. A\u00ednda que poderiamos facer a configuraci\u00f3n desde esta conta, vamos configurar a aplicaci\u00f3n desde a do usuario ec2-user . sudo -iu ec2-user Comproba que te\u00f1as conexi\u00f3n a Internet a trav\u00e9s dos gateways NAT facendo ping , por exemplo, aos servidores DNS do Google. ping 8.8.8.8 Nota Se non houbera conexi\u00f3n, revisa que na configuraci\u00f3n das t\u00e1boas de rutas asociadas \u00e1 subrede na que lanzaches a instancia, o tr\u00e1fico estexa sendo encami\u00f1ado cara ao gateway NAT.","title":"Conectate \u00e1 instancia"},{"location":"ami/#comproba-a-conexion-coa-bd","text":"Instala o cliente MySQL. sudo dnf update -y wget https://dev.mysql.com/get/mysql80-community-release-el9-5.noarch.rpm sudo dnf install mysql80-community-release-el9-5.noarch.rpm sudo dnf install -y mysql-community-client Con\u00e9ctate ao cluster de BD Aurora. Usa o endpoint da instancia de escritura que copiaches ao configurar o cluster e a se\u00f1a que configuraras para o usuario admin . mysql -h <endpoint_da_instancia_de_escritura> -u admin -p Nota Se non consegues conectar, revisa o endpoint , a se\u00f1a, que a instancia estexa nunha subrede privada da capa de aplicaci\u00f3n e te\u00f1a asignado o grupo de seguranza desa capa, que a BD te\u00f1a asignado o grupo de seguranza da capa de datos e que o grupo de seguranza da capa de datos estexa correctamente configurado. Comproba as BD que hai. F\u00edxate en que non hai ningunha chamada tasks . SHOW DATABASES; Pecha a conexi\u00f3n co comando exit .","title":"Comproba a conexi\u00f3n coa BD"},{"location":"ami/#configura-a-aplicacion","text":"Instala Apache, git, PHP e as extensi\u00f3ns PHP para MySQL. sudo dnf install -y httpd git php php-pdo php-mysqli Descarga a aplicaci\u00f3n. sudo git clone https://github.com/gei-eii/todo-php /var/www/html/ Crea un directorio para a configuraci\u00f3n e move o ficheiro de configuraci\u00f3n dentro del. sudo mkdir /var/www/configs && \\ sudo mv /var/www/html/config.php /var/www/configs/ Cambia o propietario ao usuario apache , que \u00e9 o que se usa para executar o servidor web. sudo chown -R apache:apache /var/www/configs Edita o ficheiro /var/www/configs/config.php cos datos seguintes: host : o endpoint da instancia de escritura que copiaches ao configurar o cluster de BD Aurora. username : admin password : a se\u00f1a que configuraras para o usuario admin ao crear o cluster de BD Aurora. Importante Isto non \u00e9 considerado como unha boa pr\u00e1ctica . AWS recomenda usar o servizo Secrets Manager para gardar esta informaci\u00f3n de maneira segura. Fac\u00e9molo as\u00ed por simplificar a pr\u00e1ctica. Activa e inicia Apache. sudo systemctl enable --now httpd Accede \u00e1 p\u00e1xina principal. Se a configuraci\u00f3n se fixo correctamente, devolver\u00e1 a p\u00e1xina principal da aplicaci\u00f3n precedida dun erro indicando que non se atopou a BD tasks . curl localhost","title":"Configura a aplicaci\u00f3n"},{"location":"ami/#crea-a-bd","text":"Crea a BD da aplicaci\u00f3n executando o script install.php . cd /var/www/html/ && \\ php install.php Imaxe: sa\u00edda do comando que crea a BD. Con\u00e9ctate de novo ao cluster de BD Aurora e comproba co comando SHOW DATABASES; que agora hai unha nova BD chamada tasks . Repite o acceso \u00e1 p\u00e1xina. Agora, como parte da sa\u00edda, am\u00f3sase o DNS privado da instancia e o endpoint do cluster de BD curl localhost | grep host Imaxe: sa\u00edda do comando curl.","title":"Crea a BD"},{"location":"ami/#crea-a-ami","text":"Vamos crear unha AMI da inst\u00e1ncia de aplicaci\u00f3n que acabamos de configurar para usala posteriormente cando configuremos o balanceador de carga e o grupo de autoescalamento na capa de aplicaci\u00f3n. No men\u00fa de acci\u00f3ns da instancia, submen\u00fa Imaxes e modelos , escolle a opci\u00f3n Crear imaxe para crear unha AMI coas opci\u00f3ns seguintes: Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-app-ami Descrici\u00f3n: escribe unha descrici\u00f3n para a t\u00faa AMI. Imaxe: AMI que cont\u00e9n a aplicaci\u00f3n xa configurada. Xa podes terminar a instancia EC2 que usaches para configurar a aplicaci\u00f3n.","title":"Crea a AMI"},{"location":"app/","text":"Paso 5: Configuraci\u00f3n da capa de aplicaci\u00f3n Vamos agora configurar a alta dispo\u00f1ibilidade e a escalabilidade na capa de aplicaci\u00f3n. En concreto vamos configurar: Un grupo de destino Un balanceador de carga Un modelo de execuci\u00f3n Un grupo de autoescalamento Imaxe: compo\u00f1entes da capa de aplicaci\u00f3n. Crea o grupo de destino Vamos comezar por crear un grupo de destino para usar co balanceador de carga na nosa capa de aplicaci\u00f3n. Fai o seguinte: No men\u00fa da consola de EC2 escolle a opci\u00f3n Grupos de destino . Crea un grupo premendo no bot\u00f3n Crear grupo de destino e indica as opci\u00f3ns seguintes no asistente: Tipo de destino: Instancias Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-app-targetgroup Protocolo e porta: HTTP:80 VPC: escolle a VPC que creaches para a arquitectura. Acepta para crear o grupo sen rexistrar ningunha instancia. Imaxe: propiedades do grupo de destino. Crea o balanceador de carga Para crear o balanceador fai o seguinte: No men\u00fa da consola de EC2 escolle a opci\u00f3n Balanceadores de Carga . Crea un balanceador de carga premendo no bot\u00f3n Crear balanceador de carga . Preme no bot\u00f3n Crear do tipo Balanceador de carga de aplicaci\u00f3ns . No asistente para crear un balanceador de carga de aplicaci\u00f3ns indica as opci\u00f3ns seguintes: Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-app-alb Esquema: exposto a Internet. Consulta a documentaci\u00f3n de AWS para ver cal \u00e9 a diferenza cun balanceador interno. Imaxe: configuraci\u00f3n b\u00e1sica do balanceador. VPC: escolle a VPC que creaches para a arquitectura. Mapeamento: en cada unha das d\u00faas AZ da nosa VPC, escolle a subrede p\u00fablica . Os balanceadores expostos a Internet te\u00f1en que estar asociados con subredes que te\u00f1an o tr\u00e1fico encami\u00f1ado a un gateway de Internet. Imaxe: configuraci\u00f3n de rede do balanceador. Grupo de seguranza: escolle o grupo de seguranza do balanceador de carga que creaches no paso de configuraci\u00f3n da seguranza. Roteamento: escolle no listener HTTP:80 o grupo de destino que creaches anteriormente. Imaxe: configuraci\u00f3n de seguranza e listeners do balanceador. Acepta para crear o balanceador. Imaxe: propiedades do balanceador. Imaxe: mapa de recursos nas propiedades do balanceador. Crea o modelo de execuci\u00f3n Unha vez configurado o balanceador de carga, vamos agora configurar o escalamento da nosa capa de aplicaci\u00f3n. Comezaremos por crear un modelo de execuci\u00f3n que use a AMI que creamos previamente para a nosa aplicaci\u00f3n. Fai o seguinte: No men\u00fa da consola de EC2, dentro do submen\u00fa Instancias , escolle a opci\u00f3n Modelos de execuci\u00f3n . Crea un novo modelo premendo no bot\u00f3n Crear modelo de execuci\u00f3n indicando as opci\u00f3ns seguintes: Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-app-launchcfg Descrici\u00f3n: escribe unha descrici\u00f3n para o teu modelo. Orientaci\u00f3n sobre o Auto Scaling : activa a opci\u00f3n para que o asistente nos avise se algo non est\u00e1 ben configurado para poder usar o modelo co autoescalamento de EC2. AMI: escolle a AMI da aplicaci\u00f3n que creaches no paso de configuraci\u00f3n da aplicaci\u00f3n. Tipo de instancia: t2.micro Par de chaves: escolle NON engadilas ao modelo. Subrede: escolle NON engadila no modelo. Grupo de seguranza: escolle o grupo de seguranza da capa de aplicaci\u00f3n. Detalles avanzados: escolle o perfil de instancia IAM LabInstanceProfile , que xa est\u00e1 predefinido no laboratorio de AWS Academy. Imaxe: parte da configuraci\u00f3n do modelo de execuci\u00f3n. Acepta para crear o modelo de execuci\u00f3n. Imaxe: propiedades do modelo de execuci\u00f3n. Crea o grupo de autoescalamento Para finalizar este paso, vamos agora crear o grupo de escalamento a partir do modelo de execuci\u00f3n. Fai o seguinte: Selecciona o modelo de execuci\u00f3n que ves de crear e no men\u00fa de acci\u00f3ns do modelo escolle a opci\u00f3n Crear grupo de autoescalamento . No asistente para crear o grupo indica as seguintes opci\u00f3ns: Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-app-scaling Modelo de lanzamento: comproba que xa aparece configurado o modelo que creaches previamente. Rede: escolle a VPC que creaches para a arquitectura e as subredes privadas que se crearon para a capa de aplicaci\u00f3n. Imaxe: configuraci\u00f3n da rede no grupo de escalamento. Balanceador de carga: escolle a opci\u00f3n de xuntar a un balanceador de carga existente e escolle o grupo de destino do balanceador que creaches anteriormente. Imaxe: configuraci\u00f3n do balanceamento da carga no grupo de escalamento. Comprobaci\u00f3n de estado: activa a opci\u00f3n para monitorar as instancias desde o balanceador. Imaxe: configuraci\u00f3n da comprobaci\u00f3n de estado no grupo de escalamento. Tama\u00f1o do grupo: configura a capacidade desexada e a m\u00ednima a 1, e a m\u00e1xima a 2. Pol\u00edticas de escalabilidade: non vamos definir ningunha polo dagora. Imaxe: configuraci\u00f3n do tama\u00f1o e as pol\u00edticas no grupo de escalamento. Acepta para crear o grupo deixando o resto das opci\u00f3ns ao seu valor por defecto. Ao crearse o grupo, este vai iniciar tam\u00e9n o n\u00famero de instancias que indicamos na capacidade desexada (neste caso 1). Imaxe: propiedades do grupo de escalamento. Comproba que a instancia apareza tam\u00e9n como destino rexistrado no grupo de destino do balanceador de carga e no mapa de recursos. Imaxe: instancia rexistrada no grupo de destino. Imaxe: mapa de recursos do balanceador coa instancia rexistrada no grupo de destino. Nota Nas tres capturas anteriores o ID da instancia non coincide porque foron tomadas con instancias diferentes. No teu caso deber\u00eda ser o mesmo ID xa que \u00e9 a mesma instancia. Comproba a aplicaci\u00f3n Para realizar a comprobaci\u00f3n inicial de que a arquitectura est\u00e1 correctamente configurada, fai o seguinte: Abre nun navegador a p\u00e1xina da aplicaci\u00f3n usando o nome DNS do balanceador de carga. Se todo est\u00e1 correcto, abrirase a p\u00e1xina da aplicaci\u00f3n amosando que a listaxe de tarefas pendentes est\u00e1 baleira. Imaxe: p\u00e1xina da aplicaci\u00f3n sen tarefas pendentes. Engade algunhas tarefas. Lembra po\u00f1er o teu prefixo e o curso actual diante dos nomes das tarefas. Imaxe: p\u00e1xina da aplicaci\u00f3n coa listaxe de tarefas pendentes. Importante Para evitar que o grupo de autoescalamento poda manter instancias en execuci\u00f3n cando saias da sesi\u00f3n do laboratorio de AWS Academy, lembra modificar o tama\u00f1o do grupo po\u00f1endo a cero a capacidade desexada, o m\u00ednimo e o m\u00e1ximo antes de pechar a sesi\u00f3n. Cando volvas iniciar sesi\u00f3n no laboratorio ter\u00e1s que volver configurar os valores orixinais.","title":"Paso 5: Configuraci\u00f3n da capa de aplicaci\u00f3n"},{"location":"app/#paso-5-configuracion-da-capa-de-aplicacion","text":"Vamos agora configurar a alta dispo\u00f1ibilidade e a escalabilidade na capa de aplicaci\u00f3n. En concreto vamos configurar: Un grupo de destino Un balanceador de carga Un modelo de execuci\u00f3n Un grupo de autoescalamento Imaxe: compo\u00f1entes da capa de aplicaci\u00f3n.","title":"Paso 5: Configuraci\u00f3n da capa de aplicaci\u00f3n"},{"location":"app/#crea-o-grupo-de-destino","text":"Vamos comezar por crear un grupo de destino para usar co balanceador de carga na nosa capa de aplicaci\u00f3n. Fai o seguinte: No men\u00fa da consola de EC2 escolle a opci\u00f3n Grupos de destino . Crea un grupo premendo no bot\u00f3n Crear grupo de destino e indica as opci\u00f3ns seguintes no asistente: Tipo de destino: Instancias Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-app-targetgroup Protocolo e porta: HTTP:80 VPC: escolle a VPC que creaches para a arquitectura. Acepta para crear o grupo sen rexistrar ningunha instancia. Imaxe: propiedades do grupo de destino.","title":"Crea o grupo de destino"},{"location":"app/#crea-o-balanceador-de-carga","text":"Para crear o balanceador fai o seguinte: No men\u00fa da consola de EC2 escolle a opci\u00f3n Balanceadores de Carga . Crea un balanceador de carga premendo no bot\u00f3n Crear balanceador de carga . Preme no bot\u00f3n Crear do tipo Balanceador de carga de aplicaci\u00f3ns . No asistente para crear un balanceador de carga de aplicaci\u00f3ns indica as opci\u00f3ns seguintes: Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-app-alb Esquema: exposto a Internet. Consulta a documentaci\u00f3n de AWS para ver cal \u00e9 a diferenza cun balanceador interno. Imaxe: configuraci\u00f3n b\u00e1sica do balanceador. VPC: escolle a VPC que creaches para a arquitectura. Mapeamento: en cada unha das d\u00faas AZ da nosa VPC, escolle a subrede p\u00fablica . Os balanceadores expostos a Internet te\u00f1en que estar asociados con subredes que te\u00f1an o tr\u00e1fico encami\u00f1ado a un gateway de Internet. Imaxe: configuraci\u00f3n de rede do balanceador. Grupo de seguranza: escolle o grupo de seguranza do balanceador de carga que creaches no paso de configuraci\u00f3n da seguranza. Roteamento: escolle no listener HTTP:80 o grupo de destino que creaches anteriormente. Imaxe: configuraci\u00f3n de seguranza e listeners do balanceador. Acepta para crear o balanceador. Imaxe: propiedades do balanceador. Imaxe: mapa de recursos nas propiedades do balanceador.","title":"Crea o balanceador de carga"},{"location":"app/#crea-o-modelo-de-execucion","text":"Unha vez configurado o balanceador de carga, vamos agora configurar o escalamento da nosa capa de aplicaci\u00f3n. Comezaremos por crear un modelo de execuci\u00f3n que use a AMI que creamos previamente para a nosa aplicaci\u00f3n. Fai o seguinte: No men\u00fa da consola de EC2, dentro do submen\u00fa Instancias , escolle a opci\u00f3n Modelos de execuci\u00f3n . Crea un novo modelo premendo no bot\u00f3n Crear modelo de execuci\u00f3n indicando as opci\u00f3ns seguintes: Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-app-launchcfg Descrici\u00f3n: escribe unha descrici\u00f3n para o teu modelo. Orientaci\u00f3n sobre o Auto Scaling : activa a opci\u00f3n para que o asistente nos avise se algo non est\u00e1 ben configurado para poder usar o modelo co autoescalamento de EC2. AMI: escolle a AMI da aplicaci\u00f3n que creaches no paso de configuraci\u00f3n da aplicaci\u00f3n. Tipo de instancia: t2.micro Par de chaves: escolle NON engadilas ao modelo. Subrede: escolle NON engadila no modelo. Grupo de seguranza: escolle o grupo de seguranza da capa de aplicaci\u00f3n. Detalles avanzados: escolle o perfil de instancia IAM LabInstanceProfile , que xa est\u00e1 predefinido no laboratorio de AWS Academy. Imaxe: parte da configuraci\u00f3n do modelo de execuci\u00f3n. Acepta para crear o modelo de execuci\u00f3n. Imaxe: propiedades do modelo de execuci\u00f3n.","title":"Crea o modelo de execuci\u00f3n"},{"location":"app/#crea-o-grupo-de-autoescalamento","text":"Para finalizar este paso, vamos agora crear o grupo de escalamento a partir do modelo de execuci\u00f3n. Fai o seguinte: Selecciona o modelo de execuci\u00f3n que ves de crear e no men\u00fa de acci\u00f3ns do modelo escolle a opci\u00f3n Crear grupo de autoescalamento . No asistente para crear o grupo indica as seguintes opci\u00f3ns: Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-app-scaling Modelo de lanzamento: comproba que xa aparece configurado o modelo que creaches previamente. Rede: escolle a VPC que creaches para a arquitectura e as subredes privadas que se crearon para a capa de aplicaci\u00f3n. Imaxe: configuraci\u00f3n da rede no grupo de escalamento. Balanceador de carga: escolle a opci\u00f3n de xuntar a un balanceador de carga existente e escolle o grupo de destino do balanceador que creaches anteriormente. Imaxe: configuraci\u00f3n do balanceamento da carga no grupo de escalamento. Comprobaci\u00f3n de estado: activa a opci\u00f3n para monitorar as instancias desde o balanceador. Imaxe: configuraci\u00f3n da comprobaci\u00f3n de estado no grupo de escalamento. Tama\u00f1o do grupo: configura a capacidade desexada e a m\u00ednima a 1, e a m\u00e1xima a 2. Pol\u00edticas de escalabilidade: non vamos definir ningunha polo dagora. Imaxe: configuraci\u00f3n do tama\u00f1o e as pol\u00edticas no grupo de escalamento. Acepta para crear o grupo deixando o resto das opci\u00f3ns ao seu valor por defecto. Ao crearse o grupo, este vai iniciar tam\u00e9n o n\u00famero de instancias que indicamos na capacidade desexada (neste caso 1). Imaxe: propiedades do grupo de escalamento. Comproba que a instancia apareza tam\u00e9n como destino rexistrado no grupo de destino do balanceador de carga e no mapa de recursos. Imaxe: instancia rexistrada no grupo de destino. Imaxe: mapa de recursos do balanceador coa instancia rexistrada no grupo de destino. Nota Nas tres capturas anteriores o ID da instancia non coincide porque foron tomadas con instancias diferentes. No teu caso deber\u00eda ser o mesmo ID xa que \u00e9 a mesma instancia.","title":"Crea o grupo de autoescalamento"},{"location":"app/#comproba-a-aplicacion","text":"Para realizar a comprobaci\u00f3n inicial de que a arquitectura est\u00e1 correctamente configurada, fai o seguinte: Abre nun navegador a p\u00e1xina da aplicaci\u00f3n usando o nome DNS do balanceador de carga. Se todo est\u00e1 correcto, abrirase a p\u00e1xina da aplicaci\u00f3n amosando que a listaxe de tarefas pendentes est\u00e1 baleira. Imaxe: p\u00e1xina da aplicaci\u00f3n sen tarefas pendentes. Engade algunhas tarefas. Lembra po\u00f1er o teu prefixo e o curso actual diante dos nomes das tarefas. Imaxe: p\u00e1xina da aplicaci\u00f3n coa listaxe de tarefas pendentes. Importante Para evitar que o grupo de autoescalamento poda manter instancias en execuci\u00f3n cando saias da sesi\u00f3n do laboratorio de AWS Academy, lembra modificar o tama\u00f1o do grupo po\u00f1endo a cero a capacidade desexada, o m\u00ednimo e o m\u00e1ximo antes de pechar a sesi\u00f3n. Cando volvas iniciar sesi\u00f3n no laboratorio ter\u00e1s que volver configurar os valores orixinais.","title":"Comproba a aplicaci\u00f3n"},{"location":"autoscaling/","text":"Paso 6: Configuraci\u00f3n da elasticidade na capa de aplicaci\u00f3n Neste paso vamos configurar a elasticidade no grupo de autoescalamento da capa de aplicaci\u00f3n e comprobar o seu funcionamento. En concreto vamos configurar: Alarmas para detectar cando o n\u00famero de solicitudes recibidas polas instancias da aplicaci\u00f3n desde o balanceador de carga \u00e9 alto ou baixo. Pol\u00edticas de escalamento para aumentar e diminuir o n\u00famero de instancias na capa de aplicaci\u00f3n en funci\u00f3n das alarmas anteriores. Crea unha alarma para o n\u00famero alto de conexi\u00f3ns Para crear a alarma, fai o seguinte: No men\u00fa da consola de CloudWatch escolle a opci\u00f3n Todas as alarmas Escolle a opci\u00f3n Crear alarma e no asistente indica as opci\u00f3ns seguintes: M\u00e9trica: escolle a m\u00e9trica RequestCountPerTarget na categor\u00eda ApplicationELB->TargetGroup Estat\u00edstica: Suma Periodo: 1 minuto Condici\u00f3n: >100 . Na configuraci\u00f3n adicional, escolle a opci\u00f3n Lidar con datos ausentes como ignorar . Imaxe: configuraci\u00f3n da m\u00e9trica e condici\u00f3ns da alarma. Notificaci\u00f3n: escolle o t\u00f3pico SNS que creaches no titorial desta pr\u00e1ctica. Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-alarma-alta Descrici\u00f3n: escribe unha descrici\u00f3n para a alarma. Acepta para crear a alarma deixando as demais opci\u00f3ns aos seus valores por defecto. Crea unha alarma para o n\u00famero baixo de conexi\u00f3ns Para crear a alarma, fai o seguinte: Coa alarma creada no apartado anterior seleccionada, escolle no men\u00fa de acci\u00f3ns da alarma a opci\u00f3n Copiar . No asistente edita os datos seguintes: Condici\u00f3n: <10 Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-alarma-baixa Descrici\u00f3n: escribe unha descrici\u00f3n para a alarma. Acepta para crear a alarma deixando as demais opci\u00f3ns sen modificar. Imaxe: propiedades das alarmas. Crea a pol\u00edtica para engadir instancias Para crear a pol\u00edtica de escalamento que engadir\u00e1 instancias cando o n\u00famero de conexi\u00f3ns recibidas desde o balanceador supere o l\u00edmite, fai o seguinte: Vai para a consola de EC2 e escolle o grupo de autoescalamento da capa de aplicaci\u00f3n. Na aba Escalabilidade autom\u00e1tica das propiedades do grupo, escolle a opci\u00f3n Crear unha pol\u00edtica de escalabilidade din\u00e1mica e indica as seguintes opci\u00f3ns: Tipo de pol\u00edtica: Escalabilidade simple Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-scaleout Alarma de Cloudwatch : escolle a alarma para o n\u00famero alto de conexi\u00f3ns que creaches anteriormente. Acci\u00f3n: Engadir 1 unidade de capacidade Acepta para crear a pol\u00edtica deixando as demais opci\u00f3ns aos seus valores por defecto. Crea a pol\u00edtica para eliminar instancias Repite os pasos do apartado anterior indicando agora as seguintes opci\u00f3ns: Tipo de pol\u00edtica: Escalabilidade simple Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-scalein Alarma de Cloudwatch : escolle a alarma para o n\u00famero baixo de conexi\u00f3ns que creaches anteriormente. Acci\u00f3n: Eliminar 1 unidade de capacidade Imaxe: propiedades das pol\u00edticas de escalabilidade. Proba a elasticidade da capa de aplicaci\u00f3n Vamos agora executar unha proba de carga na aplicaci\u00f3n para provocar que se activen as pol\u00edticas do grupo de escalamento. Para elo, vamos aproveitar que o comando ab xa est\u00e1 dispo\u00f1\u00edbel no terminal que nos proporciona o laboratorio de AWS Academy. Usando o DNS do teu balanceador de carga , fai as execuci\u00f3ns que sexan necesarias para provocar a activaci\u00f3n das pol\u00edticas de escalabilidade que definimos anteriormente. Nas seguintes capturas podes ver un exemplo do comportamento agardado: Imaxe: exemplo da execuci\u00f3n dunha proba de carga no terminal do laboratorio. Imaxe: estado da alarma que detecta un n\u00famero elevado de conexi\u00f3ns e hist\u00f3rico que amosa que se aplicou a pol\u00edtica de escalabilidade para aumentar o n\u00famero de instancias. Imaxe: estado do grupo de destino do balanceador con d\u00faas instancias en AZ diferentes despois de aplicar a pol\u00edtica de escalabilidade. Imaxe: mapa de recursos do balanceador con d\u00faas instancias rexistradas despois de aplicar a pol\u00edtica de escalabilidade. Nota Nas duas capturas anteriores o ID das instancias non coincide porque foron tomadas con instancias diferentes. No teu caso deber\u00edan ser os mesmos ID xa que son as mesmas instancias. Nota Se recargas varias veces a p\u00e1xina da aplicaci\u00f3n coa listaxe de tarefas pendentes mentres haxa d\u00faas instancias en execuci\u00f3n, ver\u00e1s que cambia a informaci\u00f3n do DNS privado que sirve a p\u00e1xina dependendo de a que instancia redirixa a solicitude o balanceador. Imaxe: DNS privado da instancia que serve a p\u00e1xina da aplicaci\u00f3n. Unha vez a proba de carga remate, e pase un certo tempo sen realizar m\u00e1is conexi\u00f3ns, act\u00edvase de novo o grupo de escalamento para reducir o n\u00famero de instancias, como amosan as seguintes capturas: Imaxe: estado da alarma que detecta un n\u00famero reducido de conexi\u00f3ns e hist\u00f3rico que amosa que se aplicou a pol\u00edtica de escalabilidade para reducir o n\u00famero de instancias. Imaxe: estado do grupo de destino do balanceador coa instancia que se est\u00e1 a eliminar como consecuencia de aplicar a pol\u00edtica de escalabilidade. Imaxe: historico do grupo de escalamento no que se amosa a aplicaci\u00f3n das pol\u00edticas de escalabilidade. Tam\u00e9n aparece a substituci\u00f3n dunha instancia debido a un fallo na comprobaci\u00f3n de estado realizada desde o balanceador. Imaxe: mapa de recursos do balanceador coa instancia que se est\u00e1 a eliminar como consecuencia de aplicar a pol\u00edtica de escalabilidade. Nota Na \u00faltima captura o ID das instancias non coincide coas das d\u00faas anteriores porque foron tomadas con instancias diferentes. No teu caso deber\u00edan ser os mesmos ID xa que son as mesmas instancias.","title":"Paso 6: Configuraci\u00f3n da elasticidade na capa de aplicaci\u00f3n"},{"location":"autoscaling/#paso-6-configuracion-da-elasticidade-na-capa-de-aplicacion","text":"Neste paso vamos configurar a elasticidade no grupo de autoescalamento da capa de aplicaci\u00f3n e comprobar o seu funcionamento. En concreto vamos configurar: Alarmas para detectar cando o n\u00famero de solicitudes recibidas polas instancias da aplicaci\u00f3n desde o balanceador de carga \u00e9 alto ou baixo. Pol\u00edticas de escalamento para aumentar e diminuir o n\u00famero de instancias na capa de aplicaci\u00f3n en funci\u00f3n das alarmas anteriores.","title":"Paso 6: Configuraci\u00f3n da elasticidade na capa de aplicaci\u00f3n"},{"location":"autoscaling/#crea-unha-alarma-para-o-numero-alto-de-conexions","text":"Para crear a alarma, fai o seguinte: No men\u00fa da consola de CloudWatch escolle a opci\u00f3n Todas as alarmas Escolle a opci\u00f3n Crear alarma e no asistente indica as opci\u00f3ns seguintes: M\u00e9trica: escolle a m\u00e9trica RequestCountPerTarget na categor\u00eda ApplicationELB->TargetGroup Estat\u00edstica: Suma Periodo: 1 minuto Condici\u00f3n: >100 . Na configuraci\u00f3n adicional, escolle a opci\u00f3n Lidar con datos ausentes como ignorar . Imaxe: configuraci\u00f3n da m\u00e9trica e condici\u00f3ns da alarma. Notificaci\u00f3n: escolle o t\u00f3pico SNS que creaches no titorial desta pr\u00e1ctica. Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-alarma-alta Descrici\u00f3n: escribe unha descrici\u00f3n para a alarma. Acepta para crear a alarma deixando as demais opci\u00f3ns aos seus valores por defecto.","title":"Crea unha alarma para o n\u00famero alto de conexi\u00f3ns"},{"location":"autoscaling/#crea-unha-alarma-para-o-numero-baixo-de-conexions","text":"Para crear a alarma, fai o seguinte: Coa alarma creada no apartado anterior seleccionada, escolle no men\u00fa de acci\u00f3ns da alarma a opci\u00f3n Copiar . No asistente edita os datos seguintes: Condici\u00f3n: <10 Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-alarma-baixa Descrici\u00f3n: escribe unha descrici\u00f3n para a alarma. Acepta para crear a alarma deixando as demais opci\u00f3ns sen modificar. Imaxe: propiedades das alarmas.","title":"Crea unha alarma para o n\u00famero baixo de conexi\u00f3ns"},{"location":"autoscaling/#crea-a-politica-para-engadir-instancias","text":"Para crear a pol\u00edtica de escalamento que engadir\u00e1 instancias cando o n\u00famero de conexi\u00f3ns recibidas desde o balanceador supere o l\u00edmite, fai o seguinte: Vai para a consola de EC2 e escolle o grupo de autoescalamento da capa de aplicaci\u00f3n. Na aba Escalabilidade autom\u00e1tica das propiedades do grupo, escolle a opci\u00f3n Crear unha pol\u00edtica de escalabilidade din\u00e1mica e indica as seguintes opci\u00f3ns: Tipo de pol\u00edtica: Escalabilidade simple Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-scaleout Alarma de Cloudwatch : escolle a alarma para o n\u00famero alto de conexi\u00f3ns que creaches anteriormente. Acci\u00f3n: Engadir 1 unidade de capacidade Acepta para crear a pol\u00edtica deixando as demais opci\u00f3ns aos seus valores por defecto.","title":"Crea a pol\u00edtica para engadir instancias"},{"location":"autoscaling/#crea-a-politica-para-eliminar-instancias","text":"Repite os pasos do apartado anterior indicando agora as seguintes opci\u00f3ns: Tipo de pol\u00edtica: Escalabilidade simple Nome: dalle un nome precedido do teu prefixo e curso, p.ex. xcpm2223-scalein Alarma de Cloudwatch : escolle a alarma para o n\u00famero baixo de conexi\u00f3ns que creaches anteriormente. Acci\u00f3n: Eliminar 1 unidade de capacidade Imaxe: propiedades das pol\u00edticas de escalabilidade.","title":"Crea a pol\u00edtica para eliminar instancias"},{"location":"autoscaling/#proba-a-elasticidade-da-capa-de-aplicacion","text":"Vamos agora executar unha proba de carga na aplicaci\u00f3n para provocar que se activen as pol\u00edticas do grupo de escalamento. Para elo, vamos aproveitar que o comando ab xa est\u00e1 dispo\u00f1\u00edbel no terminal que nos proporciona o laboratorio de AWS Academy. Usando o DNS do teu balanceador de carga , fai as execuci\u00f3ns que sexan necesarias para provocar a activaci\u00f3n das pol\u00edticas de escalabilidade que definimos anteriormente. Nas seguintes capturas podes ver un exemplo do comportamento agardado: Imaxe: exemplo da execuci\u00f3n dunha proba de carga no terminal do laboratorio. Imaxe: estado da alarma que detecta un n\u00famero elevado de conexi\u00f3ns e hist\u00f3rico que amosa que se aplicou a pol\u00edtica de escalabilidade para aumentar o n\u00famero de instancias. Imaxe: estado do grupo de destino do balanceador con d\u00faas instancias en AZ diferentes despois de aplicar a pol\u00edtica de escalabilidade. Imaxe: mapa de recursos do balanceador con d\u00faas instancias rexistradas despois de aplicar a pol\u00edtica de escalabilidade. Nota Nas duas capturas anteriores o ID das instancias non coincide porque foron tomadas con instancias diferentes. No teu caso deber\u00edan ser os mesmos ID xa que son as mesmas instancias. Nota Se recargas varias veces a p\u00e1xina da aplicaci\u00f3n coa listaxe de tarefas pendentes mentres haxa d\u00faas instancias en execuci\u00f3n, ver\u00e1s que cambia a informaci\u00f3n do DNS privado que sirve a p\u00e1xina dependendo de a que instancia redirixa a solicitude o balanceador. Imaxe: DNS privado da instancia que serve a p\u00e1xina da aplicaci\u00f3n. Unha vez a proba de carga remate, e pase un certo tempo sen realizar m\u00e1is conexi\u00f3ns, act\u00edvase de novo o grupo de escalamento para reducir o n\u00famero de instancias, como amosan as seguintes capturas: Imaxe: estado da alarma que detecta un n\u00famero reducido de conexi\u00f3ns e hist\u00f3rico que amosa que se aplicou a pol\u00edtica de escalabilidade para reducir o n\u00famero de instancias. Imaxe: estado do grupo de destino do balanceador coa instancia que se est\u00e1 a eliminar como consecuencia de aplicar a pol\u00edtica de escalabilidade. Imaxe: historico do grupo de escalamento no que se amosa a aplicaci\u00f3n das pol\u00edticas de escalabilidade. Tam\u00e9n aparece a substituci\u00f3n dunha instancia debido a un fallo na comprobaci\u00f3n de estado realizada desde o balanceador. Imaxe: mapa de recursos do balanceador coa instancia que se est\u00e1 a eliminar como consecuencia de aplicar a pol\u00edtica de escalabilidade. Nota Na \u00faltima captura o ID das instancias non coincide coas das d\u00faas anteriores porque foron tomadas con instancias diferentes. No teu caso deber\u00edan ser os mesmos ID xa que son as mesmas instancias.","title":"Proba a elasticidade da capa de aplicaci\u00f3n"},{"location":"clear/","text":"Paso 8: Eliminaci\u00f3n de recursos Por \u00faltimo vamos limpar os recursos que se crearon na pr\u00e1ctica para evitar gastos innecesarios. Debido \u00e1s dependencias entre eles \u00e9 preciso eliminalos seguindo unha orde determinada. Fai o seguinte: Recursos da capa de aplicaci\u00f3n Grupo de escalamento No servizo EC2, termina as instancias da aplicaci\u00f3n que estexan en execuci\u00f3n po\u00f1endo a capacidade m\u00ednima , capacidade desexada e capacidade m\u00e1xima a 0 nas propiedades do grupo de autoescalamento. Unha vez que se terminen as instancias e xa non aparezan no grupo de destino do balanceador, elimina o grupo de autoescalamento. Modelo de execuci\u00f3n No servizo EC2, elimina o modelo de execuci\u00f3n que se usou para lanzar as instancias da aplicaci\u00f3n. AMI No servizo EC2, cancela o rexistro da AMI que se creou coa configuraci\u00f3n da aplicaci\u00f3n. Instant\u00e1nea No servizo EC2, elimina a instant\u00e1nea que se creou para a AMI. Alarmas e notificaci\u00f3ns No servizo Cloudwatch, elimina as alarmas. No servizo SNS, elimina o t\u00f3pico e a subscrici\u00f3n que se crearon para a notificaci\u00f3n das alarmas. Balanceador de carga No servizo EC2, elimina o balanceador de carga da capa de aplicaci\u00f3n. Elimina o grupo de destino do balanceador. Recursos da capa de datos Cluster de BD Aurora No servizo RDS, elimina o cluster de BD da capa de datos. Ter\u00e1s que eliminar primeiro as instancias unha a unha. Nota Se se che pregunta, non aceptes sacar unha instant\u00e1nea do estado da BD antes de eliminar o cluster. Se houbera instant\u00e1neas da BD creadas automaticamente polo servizo RDS, elim\u00ednaas. Elimina o grupo de subredes. Recursos de rede Gateways NAT e IP el\u00e1sticos No servizo VPC, elimina os gateways NAT. Libera os IP el\u00e1sticos. VPC No servizo VPC, elimina a VPC. Isto tam\u00e9n eliminar\u00e1 as subredes, t\u00e1boas de rutas, grupos de seguranza e o gateway de Internet.","title":"Paso 8: Eliminaci\u00f3n de recursos"},{"location":"clear/#paso-8-eliminacion-de-recursos","text":"Por \u00faltimo vamos limpar os recursos que se crearon na pr\u00e1ctica para evitar gastos innecesarios. Debido \u00e1s dependencias entre eles \u00e9 preciso eliminalos seguindo unha orde determinada. Fai o seguinte:","title":"Paso 8: Eliminaci\u00f3n de recursos"},{"location":"clear/#recursos-da-capa-de-aplicacion","text":"","title":"Recursos da capa de aplicaci\u00f3n"},{"location":"clear/#grupo-de-escalamento","text":"No servizo EC2, termina as instancias da aplicaci\u00f3n que estexan en execuci\u00f3n po\u00f1endo a capacidade m\u00ednima , capacidade desexada e capacidade m\u00e1xima a 0 nas propiedades do grupo de autoescalamento. Unha vez que se terminen as instancias e xa non aparezan no grupo de destino do balanceador, elimina o grupo de autoescalamento.","title":"Grupo de escalamento"},{"location":"clear/#modelo-de-execucion","text":"No servizo EC2, elimina o modelo de execuci\u00f3n que se usou para lanzar as instancias da aplicaci\u00f3n.","title":"Modelo de execuci\u00f3n"},{"location":"clear/#ami","text":"No servizo EC2, cancela o rexistro da AMI que se creou coa configuraci\u00f3n da aplicaci\u00f3n.","title":"AMI"},{"location":"clear/#instantanea","text":"No servizo EC2, elimina a instant\u00e1nea que se creou para a AMI.","title":"Instant\u00e1nea"},{"location":"clear/#alarmas-e-notificacions","text":"No servizo Cloudwatch, elimina as alarmas. No servizo SNS, elimina o t\u00f3pico e a subscrici\u00f3n que se crearon para a notificaci\u00f3n das alarmas.","title":"Alarmas e notificaci\u00f3ns"},{"location":"clear/#balanceador-de-carga","text":"No servizo EC2, elimina o balanceador de carga da capa de aplicaci\u00f3n. Elimina o grupo de destino do balanceador.","title":"Balanceador de carga"},{"location":"clear/#recursos-da-capa-de-datos","text":"","title":"Recursos da capa de datos"},{"location":"clear/#cluster-de-bd-aurora","text":"No servizo RDS, elimina o cluster de BD da capa de datos. Ter\u00e1s que eliminar primeiro as instancias unha a unha. Nota Se se che pregunta, non aceptes sacar unha instant\u00e1nea do estado da BD antes de eliminar o cluster. Se houbera instant\u00e1neas da BD creadas automaticamente polo servizo RDS, elim\u00ednaas. Elimina o grupo de subredes.","title":"Cluster de BD Aurora"},{"location":"clear/#recursos-de-rede","text":"","title":"Recursos de rede"},{"location":"clear/#gateways-nat-e-ip-elasticos","text":"No servizo VPC, elimina os gateways NAT. Libera os IP el\u00e1sticos.","title":"Gateways NAT e IP el\u00e1sticos"},{"location":"clear/#vpc","text":"No servizo VPC, elimina a VPC. Isto tam\u00e9n eliminar\u00e1 as subredes, t\u00e1boas de rutas, grupos de seguranza e o gateway de Internet.","title":"VPC"},{"location":"ha/","text":"Paso 7: Proba da dispo\u00f1ibilidade Vamos agora comprobar como se comporta a nosa arquitectura desde o ponto de vista da dispo\u00f1ibilidade usando unha aproximaci\u00f3n baseada na inxecci\u00f3n controlada de fallas. A inxecci\u00f3n de fallas ( Failure Injection ) \u00e9 unha compo\u00f1ente chave da Enxe\u00f1ar\u00eda do Caos ( Chaos Engineering ) , que utiliza esta t\u00e9cnica para provocar situaci\u00f3ns ca\u00f3ticas, da\u00ed o nome, que permitan testar hip\u00f3teses sobre a resiliencia das cargas de traballo. Consiste en simular eventos que poder\u00edan afectar a servizos en producci\u00f3n e analizar o comportamento das arquitecturas dos servizos, tratando de identificar que compo\u00f1entes non proporcionan unha resposta adecuada ante a ocorrencia de avar\u00edas. Hai diferentes alternativas entre as que escoller \u00e1 hora de preparar probas de inxecci\u00f3n de fallas en AWS. Por exemplo: Usar o servizo Fault Injection Service (FIS) . Simular as fallas usando os comandos da CLI de AWS, as opci\u00f3ns dispo\u00f1\u00edbeis nas consolas dos servizos, ou o soporte nativo inclu\u00eddo nalg\u00fans servizos (p.ex. Aurora). Usar scripts , programas e/ou ferramentas (p.ex. Chaos Toolkit ou Gremlin ) que simulen as fallas mediante chamadas a API dos servizos. Como o servizo FIS non est\u00e1 inclu\u00eddo nos laboratorios de AWS Academy, e as probas que vamos facer son simples, vamos inxectar as fallas usando unha combinaci\u00f3n de comandos da CLI de AWS e consultas SQL para inxecci\u00f3n de fallas dispo\u00f1\u00edbeis en Aurora. Os escenarios que vamos probar son os seguintes: A avar\u00eda da instancia da aplicaci\u00f3n. A avar\u00eda do volume do cluster de BD Aurora. A avar\u00eda da instancia primaria do cluster de BD Aurora. Avar\u00eda na instancia da aplicaci\u00f3n Para simular unha avar\u00eda na instancia da aplicaci\u00f3n vamos usar un comando da CLI de AWS para terminala. Fai o seguinte: Na consola de EC2 aseg\u00farate de que s\u00f3 haxa unha instancia en execuci\u00f3n. No terminal do laboratorio de AWS Academy, que xa ten a CLI de AWS configurada, executa os comandos seguintes para terminar a instancia: # almacena o ID da instancia instance_id=`aws ec2 describe-instances --filter Name=instance-state-name,Values=running | jq -r '.Reservations[0].Instances[0].InstanceId'` # termina a instancia aws ec2 terminate-instances --instance-ids $instance_id Imaxe: inxecci\u00f3n de fallas na instancia da aplicaci\u00f3n usando a CLI de AWS. Comproba no hist\u00f3rico de actividade do grupo de autoescalamento como se termina a instancia e se lanza unha nova para repo\u00f1ela. Nota Mentres se produce o cambio de instancia, recarga varias veces a p\u00e1xina da aplicaci\u00f3n para comprobar como se perde a conexi\u00f3n e, unha vez a nova instancia estexa iniciada, volve recuperarse. Imaxe: hist\u00f3rico do grupo de escalamento no que se amosa como se detectou que a instancia foi terminada e se iniciou unha nova para substitu\u00edla e manter a capacidade m\u00ednima configurada no grupo. O comportamento observado na proba anterior pode non ser acept\u00e1bel en escenarios nos que se requira un tempo medio de restauraci\u00f3n do servizo (MTTRS) inferior ao tempo necesario para repor a instancia afectada pola falla. Para evitar a perda de conexi\u00f3n coa p\u00e1xina da aplicaci\u00f3n, unha soluci\u00f3n ser\u00eda manter unha capacidade m\u00ednima de d\u00faas instancias repartidas entre as d\u00faas AZ do grupo de escalamento. Vamos repetir o experimento con esa configuraci\u00f3n para verificar se se comporta consonte ao agardado. Fai o seguinte: Cambia as propiedades capacidade desexada e capacidade m\u00ednima a 2 e a capacidade m\u00e1xima a 4 na configuraci\u00f3n do tama\u00f1o do grupo de autoescalamento. Nota F\u00edxate en que se aumentaramos a capacidade desexada a 2 sen aumentar a capacidade m\u00ednima, o grupo lanzar\u00eda unha nova instancia para cumprir coa capacidade desexada, pero ao ter un nivel baixo de conexi\u00f3ns, pasado un minuto activar\u00edase a pol\u00edtica de escalabilidade que elimina unha instancia e volveriamos a ter unha \u00fanica instancia. Agarda a que o grupo de autoescalamento inicie unha nova instancia. Cando te\u00f1as d\u00faas instancias iniciadas e rexistradas no grupo de destino do balanceador, repite a execuci\u00f3n dos comandos que inxectan a falla nunha instancia. Imaxe: estado do grupo de destino do balanceador con d\u00faas instancias en AZ diferentes despois de cambiar a configuraci\u00f3n do grupo de autoescalamento. Comproba no grupo de autoescalamento como se termina unha instancia e se lanza unha nova para repo\u00f1ela. Nota Agora, se recargas varias veces a p\u00e1xina da aplicaci\u00f3n mentres se rep\u00f3n a instancia, a\u00ednda que pode haber cortes puntuais, a conexi\u00f3n se recupera, xa que seguimos tendo unha instancia en execuci\u00f3n que se fai cargo das solicitudes. Imaxe: hist\u00f3rico do grupo de escalamento no que se amosa como se lanzou unha nova instancia ao cambiar a configuraci\u00f3n do grupo e como, posteriormente, se detectou que unha instancia foi terminada e se iniciou unha nova para substitu\u00edla e manter a capacidade m\u00ednima configurada no grupo. Deixa a configuraci\u00f3n do tama\u00f1o do grupo de autoescalamento nos seus valores orixinais, capacidade m\u00ednima e capacidade desexada a 1 e capacidade m\u00e1xima a 2. Agarda a que o grupo de escalamento aplique os cambios e quede unha \u00fanica instancia rexistrada no grupo de destino do balanceador. Avar\u00eda no volume do cluster de BD Aurora Aurora fornece de maneira nativa consultas SQL para inxecci\u00f3n de fallas que permiten simular fallas nas instancias ou no volume de almacenamento. Vamos usar estas consultas para simular unha falla no almacenamento. Fai o seguinte: Desde a p\u00e1xina web da aplicaci\u00f3n, crea unha nova tarefa. Elimina a tarefa que creaches no punto anterior. Nota F\u00edxate no tempo que transcorre desde que aceptes engadir ou eliminar unha tarefa at\u00e9 que se recargue a p\u00e1xina principal. Nese tempo fanse 2 consultas \u00e1 BD, unha para engadir/eliminar a tarefa e outra para obter a listaxe de tarefas pendentes (cach\u00e9 da instancia de BD mediante). Desde a consola de EC2, con\u00e9ctate \u00e1 instancia da aplicaci\u00f3n usando o Administrador de Sesi\u00f3ns . No terminal que se abre no navegador, c\u00e1mbiate ao usuario ec2-user . Usando o endpoint da instancia de escritura e o contrasinal que configuraras para o usuario admin , simula unha falla parcial no volume de almacenamento da BD executando a seguinte consulta: mysql -h <endpoint_da_instancia_de_escritura> -u admin -p \\ -e \"ALTER SYSTEM SIMULATE 75 PERCENT DISK FAILURE FOR INTERVAL 3 MINUTE;\" Repite os puntos 1 e 2. Nota A aplicaci\u00f3n segue a funcionar malia que os tempos sexan sens\u00edbelmente superiores. Simula agora unha falla total executando de novo o comando do punto 5 cun valor do 100% na poncentaxe de falla. Repite os puntos 1 e 2. Nota Agora a aplicaci\u00f3n deixa de respostar durante un tempo porque non \u00e9 quen de realizar escrituras na BD. Imaxe: exemplo da mensaxe de erro na conexi\u00f3n co cluster de BD (a mensaxe pode ser diferente no teu caso). Cando transcorran os 3 minutos da simulaci\u00f3n da falla, a aplicaci\u00f3n recuperar\u00e1 o seu comportamento normal. Compr\u00f3bao repetindo os puntos 1 e 2. Avar\u00eda na instancia primaria do cluster de BD Aurora Vamos simular agora unha falla na instancia primaria do cluster de BD Aurora e comprobar se se realiza o failover (promoci\u00f3n da r\u00e9plica de lectura a primario) correctamente e como iso afecta \u00e1 dispo\u00f1ibilidade da aplicaci\u00f3n. Vamos usar un comando da CLI de AWS a\u00ednda que se poder\u00eda facer tam\u00e9n usando a opci\u00f3n Failover que hai no men\u00fa de acci\u00f3ns das instancias do cluster na consola do servizo RDS. Fai o seguinte: Na consola de RDS comproba o estado actual do cluster de BD Aurora. F\u00edxate no rol que ten cada instancia. Imaxe: estado inicial das instancias do cluster de BD. No terminal do laboratorio de AWS Academy, comproba cal \u00e9 a instancia primaria do cluster executando o seguinte comando: aws rds describe-db-clusters --query \"DBClusters[0].DBClusterMembers[?IsClusterWriter].DBInstanceIdentifier\" --output text Imaxe: identificador da instancia primaria do cluster de BD usando a CLI de AWS. Forza o failover do cluster executando os comandos seguintes no terminal do laboratorio de AWS Academy: # almacena o ID do cluster de BD Aurora cluster_id=`aws rds describe-db-clusters --query \"DBClusters[0].DBClusterIdentifier\" --output text` # forza o failover do cluster aws rds failover-db-cluster --db-cluster-identifier $cluster_id Imaxe: forzado dun failover do cluster de BD usando a CLI de AWS. Nota Mentres se leva a cabo o failover , recarga varias veces a p\u00e1xina da aplicaci\u00f3n para comprobar se se perde a conexi\u00f3n. Comproba na consola de RDS e no terminal do laboratorio de AWS Academy o estado do cluster despois do failover . Imaxe: estado do cluster despois do failover. Os roles das instancias intercambiaronse. Imaxe: a replica de s\u00f3 lectura pasou a ser a instancia primaria do cluster despois do failover. Repite os puntos 3 e 4 para provocar outro failover e comproba que se recupera o estado inicial do cluster. Na consola de RDS, comproba na aba Logs e eventos das propiedades do cluster que aparecen os eventos dos dous failovers que se fixeron. Imaxe: eventos dos dous failovers. Nota F\u00edxate en que o failover se realizou en ambos casos nun segundo ou menos, polo que a BD s\u00f3 deixou de estar dispo\u00f1\u00edbel un tempo moi pequeno.","title":"Paso 7: Proba da dispo\u00f1ibilidade"},{"location":"ha/#paso-7-proba-da-disponibilidade","text":"Vamos agora comprobar como se comporta a nosa arquitectura desde o ponto de vista da dispo\u00f1ibilidade usando unha aproximaci\u00f3n baseada na inxecci\u00f3n controlada de fallas. A inxecci\u00f3n de fallas ( Failure Injection ) \u00e9 unha compo\u00f1ente chave da Enxe\u00f1ar\u00eda do Caos ( Chaos Engineering ) , que utiliza esta t\u00e9cnica para provocar situaci\u00f3ns ca\u00f3ticas, da\u00ed o nome, que permitan testar hip\u00f3teses sobre a resiliencia das cargas de traballo. Consiste en simular eventos que poder\u00edan afectar a servizos en producci\u00f3n e analizar o comportamento das arquitecturas dos servizos, tratando de identificar que compo\u00f1entes non proporcionan unha resposta adecuada ante a ocorrencia de avar\u00edas. Hai diferentes alternativas entre as que escoller \u00e1 hora de preparar probas de inxecci\u00f3n de fallas en AWS. Por exemplo: Usar o servizo Fault Injection Service (FIS) . Simular as fallas usando os comandos da CLI de AWS, as opci\u00f3ns dispo\u00f1\u00edbeis nas consolas dos servizos, ou o soporte nativo inclu\u00eddo nalg\u00fans servizos (p.ex. Aurora). Usar scripts , programas e/ou ferramentas (p.ex. Chaos Toolkit ou Gremlin ) que simulen as fallas mediante chamadas a API dos servizos. Como o servizo FIS non est\u00e1 inclu\u00eddo nos laboratorios de AWS Academy, e as probas que vamos facer son simples, vamos inxectar as fallas usando unha combinaci\u00f3n de comandos da CLI de AWS e consultas SQL para inxecci\u00f3n de fallas dispo\u00f1\u00edbeis en Aurora. Os escenarios que vamos probar son os seguintes: A avar\u00eda da instancia da aplicaci\u00f3n. A avar\u00eda do volume do cluster de BD Aurora. A avar\u00eda da instancia primaria do cluster de BD Aurora.","title":"Paso 7: Proba da dispo\u00f1ibilidade"},{"location":"ha/#avaria-na-instancia-da-aplicacion","text":"Para simular unha avar\u00eda na instancia da aplicaci\u00f3n vamos usar un comando da CLI de AWS para terminala. Fai o seguinte: Na consola de EC2 aseg\u00farate de que s\u00f3 haxa unha instancia en execuci\u00f3n. No terminal do laboratorio de AWS Academy, que xa ten a CLI de AWS configurada, executa os comandos seguintes para terminar a instancia: # almacena o ID da instancia instance_id=`aws ec2 describe-instances --filter Name=instance-state-name,Values=running | jq -r '.Reservations[0].Instances[0].InstanceId'` # termina a instancia aws ec2 terminate-instances --instance-ids $instance_id Imaxe: inxecci\u00f3n de fallas na instancia da aplicaci\u00f3n usando a CLI de AWS. Comproba no hist\u00f3rico de actividade do grupo de autoescalamento como se termina a instancia e se lanza unha nova para repo\u00f1ela. Nota Mentres se produce o cambio de instancia, recarga varias veces a p\u00e1xina da aplicaci\u00f3n para comprobar como se perde a conexi\u00f3n e, unha vez a nova instancia estexa iniciada, volve recuperarse. Imaxe: hist\u00f3rico do grupo de escalamento no que se amosa como se detectou que a instancia foi terminada e se iniciou unha nova para substitu\u00edla e manter a capacidade m\u00ednima configurada no grupo. O comportamento observado na proba anterior pode non ser acept\u00e1bel en escenarios nos que se requira un tempo medio de restauraci\u00f3n do servizo (MTTRS) inferior ao tempo necesario para repor a instancia afectada pola falla. Para evitar a perda de conexi\u00f3n coa p\u00e1xina da aplicaci\u00f3n, unha soluci\u00f3n ser\u00eda manter unha capacidade m\u00ednima de d\u00faas instancias repartidas entre as d\u00faas AZ do grupo de escalamento. Vamos repetir o experimento con esa configuraci\u00f3n para verificar se se comporta consonte ao agardado. Fai o seguinte: Cambia as propiedades capacidade desexada e capacidade m\u00ednima a 2 e a capacidade m\u00e1xima a 4 na configuraci\u00f3n do tama\u00f1o do grupo de autoescalamento. Nota F\u00edxate en que se aumentaramos a capacidade desexada a 2 sen aumentar a capacidade m\u00ednima, o grupo lanzar\u00eda unha nova instancia para cumprir coa capacidade desexada, pero ao ter un nivel baixo de conexi\u00f3ns, pasado un minuto activar\u00edase a pol\u00edtica de escalabilidade que elimina unha instancia e volveriamos a ter unha \u00fanica instancia. Agarda a que o grupo de autoescalamento inicie unha nova instancia. Cando te\u00f1as d\u00faas instancias iniciadas e rexistradas no grupo de destino do balanceador, repite a execuci\u00f3n dos comandos que inxectan a falla nunha instancia. Imaxe: estado do grupo de destino do balanceador con d\u00faas instancias en AZ diferentes despois de cambiar a configuraci\u00f3n do grupo de autoescalamento. Comproba no grupo de autoescalamento como se termina unha instancia e se lanza unha nova para repo\u00f1ela. Nota Agora, se recargas varias veces a p\u00e1xina da aplicaci\u00f3n mentres se rep\u00f3n a instancia, a\u00ednda que pode haber cortes puntuais, a conexi\u00f3n se recupera, xa que seguimos tendo unha instancia en execuci\u00f3n que se fai cargo das solicitudes. Imaxe: hist\u00f3rico do grupo de escalamento no que se amosa como se lanzou unha nova instancia ao cambiar a configuraci\u00f3n do grupo e como, posteriormente, se detectou que unha instancia foi terminada e se iniciou unha nova para substitu\u00edla e manter a capacidade m\u00ednima configurada no grupo. Deixa a configuraci\u00f3n do tama\u00f1o do grupo de autoescalamento nos seus valores orixinais, capacidade m\u00ednima e capacidade desexada a 1 e capacidade m\u00e1xima a 2. Agarda a que o grupo de escalamento aplique os cambios e quede unha \u00fanica instancia rexistrada no grupo de destino do balanceador.","title":"Avar\u00eda na instancia da aplicaci\u00f3n"},{"location":"ha/#avaria-no-volume-do-cluster-de-bd-aurora","text":"Aurora fornece de maneira nativa consultas SQL para inxecci\u00f3n de fallas que permiten simular fallas nas instancias ou no volume de almacenamento. Vamos usar estas consultas para simular unha falla no almacenamento. Fai o seguinte: Desde a p\u00e1xina web da aplicaci\u00f3n, crea unha nova tarefa. Elimina a tarefa que creaches no punto anterior. Nota F\u00edxate no tempo que transcorre desde que aceptes engadir ou eliminar unha tarefa at\u00e9 que se recargue a p\u00e1xina principal. Nese tempo fanse 2 consultas \u00e1 BD, unha para engadir/eliminar a tarefa e outra para obter a listaxe de tarefas pendentes (cach\u00e9 da instancia de BD mediante). Desde a consola de EC2, con\u00e9ctate \u00e1 instancia da aplicaci\u00f3n usando o Administrador de Sesi\u00f3ns . No terminal que se abre no navegador, c\u00e1mbiate ao usuario ec2-user . Usando o endpoint da instancia de escritura e o contrasinal que configuraras para o usuario admin , simula unha falla parcial no volume de almacenamento da BD executando a seguinte consulta: mysql -h <endpoint_da_instancia_de_escritura> -u admin -p \\ -e \"ALTER SYSTEM SIMULATE 75 PERCENT DISK FAILURE FOR INTERVAL 3 MINUTE;\" Repite os puntos 1 e 2. Nota A aplicaci\u00f3n segue a funcionar malia que os tempos sexan sens\u00edbelmente superiores. Simula agora unha falla total executando de novo o comando do punto 5 cun valor do 100% na poncentaxe de falla. Repite os puntos 1 e 2. Nota Agora a aplicaci\u00f3n deixa de respostar durante un tempo porque non \u00e9 quen de realizar escrituras na BD. Imaxe: exemplo da mensaxe de erro na conexi\u00f3n co cluster de BD (a mensaxe pode ser diferente no teu caso). Cando transcorran os 3 minutos da simulaci\u00f3n da falla, a aplicaci\u00f3n recuperar\u00e1 o seu comportamento normal. Compr\u00f3bao repetindo os puntos 1 e 2.","title":"Avar\u00eda no volume do cluster de BD Aurora"},{"location":"ha/#avaria-na-instancia-primaria-do-cluster-de-bd-aurora","text":"Vamos simular agora unha falla na instancia primaria do cluster de BD Aurora e comprobar se se realiza o failover (promoci\u00f3n da r\u00e9plica de lectura a primario) correctamente e como iso afecta \u00e1 dispo\u00f1ibilidade da aplicaci\u00f3n. Vamos usar un comando da CLI de AWS a\u00ednda que se poder\u00eda facer tam\u00e9n usando a opci\u00f3n Failover que hai no men\u00fa de acci\u00f3ns das instancias do cluster na consola do servizo RDS. Fai o seguinte: Na consola de RDS comproba o estado actual do cluster de BD Aurora. F\u00edxate no rol que ten cada instancia. Imaxe: estado inicial das instancias do cluster de BD. No terminal do laboratorio de AWS Academy, comproba cal \u00e9 a instancia primaria do cluster executando o seguinte comando: aws rds describe-db-clusters --query \"DBClusters[0].DBClusterMembers[?IsClusterWriter].DBInstanceIdentifier\" --output text Imaxe: identificador da instancia primaria do cluster de BD usando a CLI de AWS. Forza o failover do cluster executando os comandos seguintes no terminal do laboratorio de AWS Academy: # almacena o ID do cluster de BD Aurora cluster_id=`aws rds describe-db-clusters --query \"DBClusters[0].DBClusterIdentifier\" --output text` # forza o failover do cluster aws rds failover-db-cluster --db-cluster-identifier $cluster_id Imaxe: forzado dun failover do cluster de BD usando a CLI de AWS. Nota Mentres se leva a cabo o failover , recarga varias veces a p\u00e1xina da aplicaci\u00f3n para comprobar se se perde a conexi\u00f3n. Comproba na consola de RDS e no terminal do laboratorio de AWS Academy o estado do cluster despois do failover . Imaxe: estado do cluster despois do failover. Os roles das instancias intercambiaronse. Imaxe: a replica de s\u00f3 lectura pasou a ser a instancia primaria do cluster despois do failover. Repite os puntos 3 e 4 para provocar outro failover e comproba que se recupera o estado inicial do cluster. Na consola de RDS, comproba na aba Logs e eventos das propiedades do cluster que aparecen os eventos dos dous failovers que se fixeron. Imaxe: eventos dos dous failovers. Nota F\u00edxate en que o failover se realizou en ambos casos nun segundo ou menos, polo que a BD s\u00f3 deixou de estar dispo\u00f1\u00edbel un tempo moi pequeno.","title":"Avar\u00eda na instancia primaria do cluster de BD Aurora"},{"location":"rds/","text":"Paso 3: Configuraci\u00f3n da capa de datos O seguinte paso vai ser a configuraci\u00f3n da capa de datos da arquitectura. Vamos utilizar un cluster de BD Aurora despregado nas d\u00faas AZ da nosa VPC para proporcionar alta dispo\u00f1ibilidade nesta capa. En concreto, vamos configurar o seguinte: Un grupo de subredes para a despregadura do cluster de BD Aurora. O cluster de BD Aurora en configuraci\u00f3n multi-AZ. Imaxe: compo\u00f1entes da capa de datos. Crea o grupo de subredes Os grupos de subredes definen que subredes dunha VPC ser\u00e1n usadas para despregar a BD. Un grupo de subredes ten que ter subredes nun m\u00ednimo de d\u00faas zonas de dispo\u00f1ibilidade. Para crealos fai o seguinte: Desde a consola de AWS, accede ao servizo RDS. No men\u00fa do servizo RDS, escolle a opci\u00f3n: Grupos de subredes . Escolle a opci\u00f3n para crear un novo grupo de subrede e indica as opci\u00f3ns seguintes: Nome: dalle un nome ao grupo. Lembra po\u00f1er as tuas iniciais seguidas do curso acad\u00e9mico, p.ex. xcpm2223-db-subnets . Descrici\u00f3n: pon unha descrici\u00f3n para o grupo. VPC: escolle a VPC que creaches para a arquitectura. Zonas de dispo\u00f1ibilidade: escolle as d\u00faas AZ nas que est\u00e1n as subredes privadas que se crearon como parte da VPC. Subredes: escolle as d\u00faas subredes privadas, de AZ distintas , que se usar\u00e1n para a capa de datos da nosa arquitectura. Imaxe: configuraci\u00f3n dos grupos de subrede. Crea o cluster de BD Aurora Antes de crear o cluster, consulta a documentaci\u00f3n de AWS para co\u00f1ecer os conceptos b\u00e1sicos sobre os clusteres de BD Aurora . Para crear o cluster fai o seguinte: No men\u00fa do servizo RDS, escolle a opci\u00f3n: Bases de datos . Escolle a opci\u00f3n para crear unha nova base de datos e indica as opci\u00f3ns seguintes: M\u00e9todo de creaci\u00f3n: Creaci\u00f3n est\u00e1ndar Tipo de motor: Aurora (compatible con MySQL) Imaxe: configuraci\u00f3n do m\u00e9todo e tipo da BD. Modelo: Dev/Test Configuraci\u00f3ns: Dalle un nome ao cluster. Lembra po\u00f1er as tuas iniciais seguidas do curso acad\u00e9mico, p.ex. xcpm2223-db-cluster . Contrasinal principal: escolle Autoxestionada e insire unha se\u00f1a para o usuario admin da BD. Imaxe: configuraci\u00f3n do modelo e configuraci\u00f3ns do cluster de BD. Configuraci\u00f3n do almacenamento en cluster: deixa a opci\u00f3n Aurora Est\u00e1ndar . Imaxe: configuraci\u00f3n do almacenamento en cluster do cluster de BD. Configuraci\u00f3n da instancia: escolle unha instancia de tipo db.t3.medium (para que apareza na listaxe tes que activar a opci\u00f3n para ver as instancias da clase t). Dispo\u00f1ibilidade: activa a opci\u00f3n para crear unha r\u00e9plica de lectura nunha AZ diferente. Imaxe: configuraci\u00f3n da instancia e dispo\u00f1ibilidade do cluster de BD. Conectividade: escolle a VPC que creaches para a arquitectura, o grupo de subredes que se creou anteriormente e o grupo de seguranza da capa de datos. Aseg\u00farate de que o acceso p\u00fablico ao cluster estexa desactivado. Imaxe: configuraci\u00f3n da conectividade do cluster de BD. Monitoramento: desactiva o monitoramento avanzado. Configuraci\u00f3n adicional: desactiva o cifrado da BD e a actualizaci\u00f3n autom\u00e1tica de versi\u00f3ns secundarias. Nota Non aceptes ning\u00fan dos complementos suxeridos durante a creaci\u00f3n do cluster. Unha vez creado o cluster, haber\u00e1 d\u00faas instancias, unha de escritura e outra de lectura, distribuidas entre as subredes do grupo de subredes que configuramos anteriormente. Importante Copia o endpoint da instancia de escritura , xa que o precisaremos despois para configurar o acceso \u00e1 BD desde a capa de aplicaci\u00f3n. Imaxe: propiedades do cluster de BD Aurora. Nota Para que o cluster non xere custos innecesarios cando non o estexas usando, podes paralo usando a opci\u00f3n Interromper temporalmente do men\u00fa de acci\u00f3ns. Isto fai que se paren as instancias do cluster durante un per\u00edodo m\u00e1ximo de 7 d\u00edas. Se non se inician antes manualmente, pasado ese per\u00edodo o laboratorio iniciaraas automaticamente.","title":"Paso 3: Configuraci\u00f3n da capa de datos"},{"location":"rds/#paso-3-configuracion-da-capa-de-datos","text":"O seguinte paso vai ser a configuraci\u00f3n da capa de datos da arquitectura. Vamos utilizar un cluster de BD Aurora despregado nas d\u00faas AZ da nosa VPC para proporcionar alta dispo\u00f1ibilidade nesta capa. En concreto, vamos configurar o seguinte: Un grupo de subredes para a despregadura do cluster de BD Aurora. O cluster de BD Aurora en configuraci\u00f3n multi-AZ. Imaxe: compo\u00f1entes da capa de datos.","title":"Paso 3: Configuraci\u00f3n da capa de datos"},{"location":"rds/#crea-o-grupo-de-subredes","text":"Os grupos de subredes definen que subredes dunha VPC ser\u00e1n usadas para despregar a BD. Un grupo de subredes ten que ter subredes nun m\u00ednimo de d\u00faas zonas de dispo\u00f1ibilidade. Para crealos fai o seguinte: Desde a consola de AWS, accede ao servizo RDS. No men\u00fa do servizo RDS, escolle a opci\u00f3n: Grupos de subredes . Escolle a opci\u00f3n para crear un novo grupo de subrede e indica as opci\u00f3ns seguintes: Nome: dalle un nome ao grupo. Lembra po\u00f1er as tuas iniciais seguidas do curso acad\u00e9mico, p.ex. xcpm2223-db-subnets . Descrici\u00f3n: pon unha descrici\u00f3n para o grupo. VPC: escolle a VPC que creaches para a arquitectura. Zonas de dispo\u00f1ibilidade: escolle as d\u00faas AZ nas que est\u00e1n as subredes privadas que se crearon como parte da VPC. Subredes: escolle as d\u00faas subredes privadas, de AZ distintas , que se usar\u00e1n para a capa de datos da nosa arquitectura. Imaxe: configuraci\u00f3n dos grupos de subrede.","title":"Crea o grupo de subredes"},{"location":"rds/#crea-o-cluster-de-bd-aurora","text":"Antes de crear o cluster, consulta a documentaci\u00f3n de AWS para co\u00f1ecer os conceptos b\u00e1sicos sobre os clusteres de BD Aurora . Para crear o cluster fai o seguinte: No men\u00fa do servizo RDS, escolle a opci\u00f3n: Bases de datos . Escolle a opci\u00f3n para crear unha nova base de datos e indica as opci\u00f3ns seguintes: M\u00e9todo de creaci\u00f3n: Creaci\u00f3n est\u00e1ndar Tipo de motor: Aurora (compatible con MySQL) Imaxe: configuraci\u00f3n do m\u00e9todo e tipo da BD. Modelo: Dev/Test Configuraci\u00f3ns: Dalle un nome ao cluster. Lembra po\u00f1er as tuas iniciais seguidas do curso acad\u00e9mico, p.ex. xcpm2223-db-cluster . Contrasinal principal: escolle Autoxestionada e insire unha se\u00f1a para o usuario admin da BD. Imaxe: configuraci\u00f3n do modelo e configuraci\u00f3ns do cluster de BD. Configuraci\u00f3n do almacenamento en cluster: deixa a opci\u00f3n Aurora Est\u00e1ndar . Imaxe: configuraci\u00f3n do almacenamento en cluster do cluster de BD. Configuraci\u00f3n da instancia: escolle unha instancia de tipo db.t3.medium (para que apareza na listaxe tes que activar a opci\u00f3n para ver as instancias da clase t). Dispo\u00f1ibilidade: activa a opci\u00f3n para crear unha r\u00e9plica de lectura nunha AZ diferente. Imaxe: configuraci\u00f3n da instancia e dispo\u00f1ibilidade do cluster de BD. Conectividade: escolle a VPC que creaches para a arquitectura, o grupo de subredes que se creou anteriormente e o grupo de seguranza da capa de datos. Aseg\u00farate de que o acceso p\u00fablico ao cluster estexa desactivado. Imaxe: configuraci\u00f3n da conectividade do cluster de BD. Monitoramento: desactiva o monitoramento avanzado. Configuraci\u00f3n adicional: desactiva o cifrado da BD e a actualizaci\u00f3n autom\u00e1tica de versi\u00f3ns secundarias. Nota Non aceptes ning\u00fan dos complementos suxeridos durante a creaci\u00f3n do cluster. Unha vez creado o cluster, haber\u00e1 d\u00faas instancias, unha de escritura e outra de lectura, distribuidas entre as subredes do grupo de subredes que configuramos anteriormente. Importante Copia o endpoint da instancia de escritura , xa que o precisaremos despois para configurar o acceso \u00e1 BD desde a capa de aplicaci\u00f3n. Imaxe: propiedades do cluster de BD Aurora. Nota Para que o cluster non xere custos innecesarios cando non o estexas usando, podes paralo usando a opci\u00f3n Interromper temporalmente do men\u00fa de acci\u00f3ns. Isto fai que se paren as instancias do cluster durante un per\u00edodo m\u00e1ximo de 7 d\u00edas. Se non se inician antes manualmente, pasado ese per\u00edodo o laboratorio iniciaraas automaticamente.","title":"Crea o cluster de BD Aurora"},{"location":"seguranza/","text":"Paso 2: Configuraci\u00f3n da seguranza Vamos configurar agora os grupos de seguranza que van permitir/denegar o tr\u00e1fico de rede entre as diferentes capas da nosa arquitectura. En concreto, vamos crear tres grupos: Para o balanceador de carga. Para as instancias da capa de aplicaci\u00f3n. Para as instancias da capa de datos. A configuraci\u00f3n dos grupos farase de xeito que o tr\u00e1fico desde Internet s\u00f3 estea permitido no balanceador, que a capa de aplicaci\u00f3n s\u00f3 acepte tr\u00e1fico desde o balanceador, e que a capa de datos s\u00f3 acepte tr\u00e1fico desde a de aplicaci\u00f3n. Grupo de seguranza do balanceador de carga Para crear o grupo de seguranza para o balanceador de carga fai o seguinte: Desde a consola de AWS, accede ao servizo VPC. No men\u00fa do servizo VPC, escolle a opci\u00f3n: Grupos de seguranza . Escolle a opci\u00f3n para crear un novo grupo de seguranza e indica as opci\u00f3ns seguintes: Nome: dalle un nome ao grupo. Lembra po\u00f1er as tuas iniciais seguidas do curso acad\u00e9mico, p.ex. xcpm2223-elb-sg . Descrici\u00f3n: pon unha descrici\u00f3n para o grupo. VPC: escolle a VPC que creaches para a arquitectura. Regras de entrada: crea regras para permitir o tr\u00e1fico HTTP e HTTPS desde calquera IPv4 . Imaxe: grupo de seguranza do ELB. Grupo de seguranza da capa de aplicaci\u00f3n Para as instancias da capa de aplicaci\u00f3n, crea outro grupo de seguranza coa configuraci\u00f3n seguinte: Nome: dalle un nome ao grupo. Lembra po\u00f1er as tuas iniciais seguidas do curso acad\u00e9mico, p.ex. xcpm2223-app-sg . Descrici\u00f3n: pon unha descrici\u00f3n para o grupo. VPC: escolle a VPC que creaches para a arquitectura. Regras de entrada: crea regras para permitir o tr\u00e1fico HTTP e HTTPS desde o grupo de seguranza do balanceador de carga . Imaxe: grupo de seguranza da capa de aplicaci\u00f3n. Nota A\u00ednda que se engadiran regras para o tr\u00e1fico HTTPS nos grupos de seguranza anteriores, a configuraci\u00f3n de HTTPS queda fora do alcance desta pr\u00e1ctica, na que s\u00f3 vamos usar as regras HTTP. Grupo de seguranza da capa de datos Para as instancias da capa de datos, crea outro grupo de seguranza coa configuraci\u00f3n seguinte: Nome: dalle un nome ao grupo. Lembra po\u00f1er as tuas iniciais seguidas do curso acad\u00e9mico, p.ex. xcpm2223-bd-sg . Descrici\u00f3n: pon unha descrici\u00f3n para o grupo. VPC: escolle a VPC que creaches para a arquitectura. Regras de entrada: crea unha regra que permita o tr\u00e1fico de tipo MYSQL/Aurora (porta 3306) desde o grupo de seguranza da capa de aplicaci\u00f3n . Imaxe: grupo de seguranza da capa de datos.","title":"Paso 2: Configuraci\u00f3n da seguranza"},{"location":"seguranza/#paso-2-configuracion-da-seguranza","text":"Vamos configurar agora os grupos de seguranza que van permitir/denegar o tr\u00e1fico de rede entre as diferentes capas da nosa arquitectura. En concreto, vamos crear tres grupos: Para o balanceador de carga. Para as instancias da capa de aplicaci\u00f3n. Para as instancias da capa de datos. A configuraci\u00f3n dos grupos farase de xeito que o tr\u00e1fico desde Internet s\u00f3 estea permitido no balanceador, que a capa de aplicaci\u00f3n s\u00f3 acepte tr\u00e1fico desde o balanceador, e que a capa de datos s\u00f3 acepte tr\u00e1fico desde a de aplicaci\u00f3n.","title":"Paso 2: Configuraci\u00f3n da seguranza"},{"location":"seguranza/#grupo-de-seguranza-do-balanceador-de-carga","text":"Para crear o grupo de seguranza para o balanceador de carga fai o seguinte: Desde a consola de AWS, accede ao servizo VPC. No men\u00fa do servizo VPC, escolle a opci\u00f3n: Grupos de seguranza . Escolle a opci\u00f3n para crear un novo grupo de seguranza e indica as opci\u00f3ns seguintes: Nome: dalle un nome ao grupo. Lembra po\u00f1er as tuas iniciais seguidas do curso acad\u00e9mico, p.ex. xcpm2223-elb-sg . Descrici\u00f3n: pon unha descrici\u00f3n para o grupo. VPC: escolle a VPC que creaches para a arquitectura. Regras de entrada: crea regras para permitir o tr\u00e1fico HTTP e HTTPS desde calquera IPv4 . Imaxe: grupo de seguranza do ELB.","title":"Grupo de seguranza do balanceador de carga"},{"location":"seguranza/#grupo-de-seguranza-da-capa-de-aplicacion","text":"Para as instancias da capa de aplicaci\u00f3n, crea outro grupo de seguranza coa configuraci\u00f3n seguinte: Nome: dalle un nome ao grupo. Lembra po\u00f1er as tuas iniciais seguidas do curso acad\u00e9mico, p.ex. xcpm2223-app-sg . Descrici\u00f3n: pon unha descrici\u00f3n para o grupo. VPC: escolle a VPC que creaches para a arquitectura. Regras de entrada: crea regras para permitir o tr\u00e1fico HTTP e HTTPS desde o grupo de seguranza do balanceador de carga . Imaxe: grupo de seguranza da capa de aplicaci\u00f3n. Nota A\u00ednda que se engadiran regras para o tr\u00e1fico HTTPS nos grupos de seguranza anteriores, a configuraci\u00f3n de HTTPS queda fora do alcance desta pr\u00e1ctica, na que s\u00f3 vamos usar as regras HTTP.","title":"Grupo de seguranza da capa de aplicaci\u00f3n"},{"location":"seguranza/#grupo-de-seguranza-da-capa-de-datos","text":"Para as instancias da capa de datos, crea outro grupo de seguranza coa configuraci\u00f3n seguinte: Nome: dalle un nome ao grupo. Lembra po\u00f1er as tuas iniciais seguidas do curso acad\u00e9mico, p.ex. xcpm2223-bd-sg . Descrici\u00f3n: pon unha descrici\u00f3n para o grupo. VPC: escolle a VPC que creaches para a arquitectura. Regras de entrada: crea unha regra que permita o tr\u00e1fico de tipo MYSQL/Aurora (porta 3306) desde o grupo de seguranza da capa de aplicaci\u00f3n . Imaxe: grupo de seguranza da capa de datos.","title":"Grupo de seguranza da capa de datos"},{"location":"vpc/","text":"Paso 1: Configuraci\u00f3n da rede Vamos comezar por configurar as compo\u00f1entes da rede VPC que van proporcionar a capa b\u00e1sica de aillamento, seguranza e alta dispo\u00f1ibilidade \u00e1s demais compo\u00f1entes da arquitectura que vamos despregar. Vaise crear o seguinte: Unha rede VPC na que despregaremos as demais compo\u00f1entes da arquitectura. Subredes p\u00fablicas e privadas para as capas da arquitectura. Un gateway para a conexi\u00f3n \u00e1 Internet da VPC. Gateways NAT para o acceso a Internet desde as subredes privadas. T\u00e1boas de rutas para configurar o tr\u00e1fico de rede entre as subredes e os gateways . Imaxe: compo\u00f1entes da VPC. Crea a VPC Desde a consola de AWS, accede ao servizo VPC. No panel do servizo VPC, escolle a opci\u00f3n para crear unha nova VPC. No asistente para crear a VPC, indica as opci\u00f3ns seguintes: Recursos a crear: VPC e moito m\u00e1is Etiqueta do nome: deixa activa a opci\u00f3n para xerala automaticamente e pon as tuas iniciais seguidas do curso acad\u00e9mico, p.ex. xcpm2223 Bloque CIDR IPv4: no segundo campo da IP pon as 2 \u00faltimas cifras do teu DNI, p.ex. 10. 40 .0.0/16 N\u00famero de AZ: 2 N\u00famero de sub-redes p\u00fablicas: 2 N\u00famero de sub-redes privadas: 4 Gateways NAT: 1 por AZ Endpoints da VPC: Ning\u00fan Opci\u00f3ns de DNS: desactiva a opci\u00f3n Habilitar nomes de host DNS Imaxe: configuraci\u00f3n da VPC. Revisa a VPC creada Vamos agora revisar a configuraci\u00f3n das diferentes compo\u00f1entes que se crearon na VPC e modificar o que sexa preciso. Subredes Comproba o seguinte: Que hai seis subredes na VPC distribu\u00eddas en d\u00faas zonas de dispo\u00f1ibilidade, unha p\u00fablica e 2 privadas en cada AZ. Que os bloques CIDR das subredes son subconxuntos do bloque CIDR da VPC e as IP que hai dispo\u00f1\u00edbeis en cada subrede e no total. O que fai que unha subrede sexa p\u00fablica ou privada \u00e9 a t\u00e1boa de rutas \u00e1 que estexa asociada. Unha subrede p\u00fablica ter\u00e1 asociada unha t\u00e1boa que encami\u00f1e o tr\u00e1fico da subrede a un gateway de Internet. Unha subrede privada ter\u00e1 asociada unha t\u00e1boa que o encami\u00f1e a un gateway NAT. Imaxe: subrede p\u00fablica con sa\u00edda a Internet a tr\u00e1ves do gateway de Internet. Imaxe: subrede privada con sa\u00edda a Internet a trav\u00e9s dun gateway NAT. Gateways Comproba que se crearon os seguintes gateways na VPC: Un gateway de Internet \u00c9 o compo\u00f1ente da VPC que proporciona acceso p\u00fablico a Internet encarg\u00e1ndose de converter os enderezos de rede (NAT) das inst\u00e1ncias con enderezos IP p\u00fablicos. \u00c9 un compo\u00f1ente altamente dispo\u00f1\u00edbel, redundante e escalado horizontalmente. Dous gateways NAT p\u00fablicos Os gateways NAT p\u00fablicos proporcionan acceso a Internet \u00e1s inst\u00e1ncias despregadas nas subredes privadas e impeden as conexi\u00f3ns desde Internet a esas instancias. Este tipo de gateways NAT te\u00f1en que ter un enderezo IP el\u00e1stico asociado e requiren que a VPC na que est\u00e1n, te\u00f1a asociado un gateway de Internet. Consulta a documentaci\u00f3n de AWS para saber m\u00e1is sobre a diferenza entre gateways NAT p\u00fablicos e privados. Para ter alta dispo\u00f1ibilidade, despregouse un gateway NAT p\u00fablico en cada subrede p\u00fablica. Comproba en cada gateway NAT o enderezo IP el\u00e1stico que ten asociado (a IP p\u00fablica do gateway ) e a subrede na que est\u00e1 despregado. Nota Os gateways NAT son un dos poucos compo\u00f1entes dunha VPC polos que AWS cobra. O prezo depende das horas de uso e dos GB procesados polo gateway . Imaxe: gateway NAT p\u00fablico con IP el\u00e1stica \"35.171.197.120\" na subrede \"subnet-006e26a62e4e12200/xcpm2223-subnet-public2-us-east-1b\". Imaxe: enderezos IP el\u00e1sticos asociados aos gateways NAT. T\u00e1boas de rutas Comproba as asociaci\u00f3ns a subredes e rutas das t\u00e1boas de rutas que se crearon: A t\u00e1boa asociada \u00e1s subredes p\u00fablicas encami\u00f1a o tr\u00e1fico dirixido fora da VPC para o gateway de Internet. As t\u00e1boas asociadas \u00e1s subredes privadas encami\u00f1an o tr\u00e1fico dirixido fora da VPC para o gateway NAT da respectiva zona de dispo\u00f1ibilidade. Imaxe: t\u00e1boa de rutas asociada \u00e1s subredes p\u00fablicas. Imaxe: rutas na t\u00e1boa de rutas asociada \u00e1s subredes p\u00fablicas. Imaxe: t\u00e1boa de rutas asociada a unha subrede privada. Imaxe: rutas nunha t\u00e1boa de rutas asociada a unha subrede privada. F\u00edxate que as d\u00faas t\u00e1boas asociadas \u00e1s subredes privadas que est\u00e1n nunha mesma AZ fan o mesmo: o tr\u00e1fico dirixido fora da VPC \u00e9 encami\u00f1ado cara ao gateway NAT que est\u00e1 nesa mesma AZ. Polo tanto, como as rutas son as mesmas, podemos reducir o n\u00famero de t\u00e1boas de rutas asociadas a subredes privadas, deixando s\u00f3 unha en cada AZ. Faino da seguinte maneira: En cada AZ, escolle unha das t\u00e1boas de rutas que encami\u00f1a o tr\u00e1fico ao gateway NAT desa AZ e as\u00f3ciaa \u00e1s d\u00faas subredes privadas da AZ (a unha delas xa o estar\u00e1). Elimina a outra t\u00e1boa. Nas seguintes figuras am\u00f3sase o estado antes e despois dos trocos nunha das AZ. Imaxe: rutas das subredes privadas nunha das AZ antes dos trocos. Imaxe: rutas das subredes privadas na mesma AZ despois dos trocos.","title":"Paso 1: Configuraci\u00f3n da rede"},{"location":"vpc/#paso-1-configuracion-da-rede","text":"Vamos comezar por configurar as compo\u00f1entes da rede VPC que van proporcionar a capa b\u00e1sica de aillamento, seguranza e alta dispo\u00f1ibilidade \u00e1s demais compo\u00f1entes da arquitectura que vamos despregar. Vaise crear o seguinte: Unha rede VPC na que despregaremos as demais compo\u00f1entes da arquitectura. Subredes p\u00fablicas e privadas para as capas da arquitectura. Un gateway para a conexi\u00f3n \u00e1 Internet da VPC. Gateways NAT para o acceso a Internet desde as subredes privadas. T\u00e1boas de rutas para configurar o tr\u00e1fico de rede entre as subredes e os gateways . Imaxe: compo\u00f1entes da VPC.","title":"Paso 1: Configuraci\u00f3n da rede"},{"location":"vpc/#crea-a-vpc","text":"Desde a consola de AWS, accede ao servizo VPC. No panel do servizo VPC, escolle a opci\u00f3n para crear unha nova VPC. No asistente para crear a VPC, indica as opci\u00f3ns seguintes: Recursos a crear: VPC e moito m\u00e1is Etiqueta do nome: deixa activa a opci\u00f3n para xerala automaticamente e pon as tuas iniciais seguidas do curso acad\u00e9mico, p.ex. xcpm2223 Bloque CIDR IPv4: no segundo campo da IP pon as 2 \u00faltimas cifras do teu DNI, p.ex. 10. 40 .0.0/16 N\u00famero de AZ: 2 N\u00famero de sub-redes p\u00fablicas: 2 N\u00famero de sub-redes privadas: 4 Gateways NAT: 1 por AZ Endpoints da VPC: Ning\u00fan Opci\u00f3ns de DNS: desactiva a opci\u00f3n Habilitar nomes de host DNS Imaxe: configuraci\u00f3n da VPC.","title":"Crea a VPC"},{"location":"vpc/#revisa-a-vpc-creada","text":"Vamos agora revisar a configuraci\u00f3n das diferentes compo\u00f1entes que se crearon na VPC e modificar o que sexa preciso.","title":"Revisa a VPC creada"},{"location":"vpc/#subredes","text":"Comproba o seguinte: Que hai seis subredes na VPC distribu\u00eddas en d\u00faas zonas de dispo\u00f1ibilidade, unha p\u00fablica e 2 privadas en cada AZ. Que os bloques CIDR das subredes son subconxuntos do bloque CIDR da VPC e as IP que hai dispo\u00f1\u00edbeis en cada subrede e no total. O que fai que unha subrede sexa p\u00fablica ou privada \u00e9 a t\u00e1boa de rutas \u00e1 que estexa asociada. Unha subrede p\u00fablica ter\u00e1 asociada unha t\u00e1boa que encami\u00f1e o tr\u00e1fico da subrede a un gateway de Internet. Unha subrede privada ter\u00e1 asociada unha t\u00e1boa que o encami\u00f1e a un gateway NAT. Imaxe: subrede p\u00fablica con sa\u00edda a Internet a tr\u00e1ves do gateway de Internet. Imaxe: subrede privada con sa\u00edda a Internet a trav\u00e9s dun gateway NAT.","title":"Subredes"},{"location":"vpc/#gateways","text":"Comproba que se crearon os seguintes gateways na VPC: Un gateway de Internet \u00c9 o compo\u00f1ente da VPC que proporciona acceso p\u00fablico a Internet encarg\u00e1ndose de converter os enderezos de rede (NAT) das inst\u00e1ncias con enderezos IP p\u00fablicos. \u00c9 un compo\u00f1ente altamente dispo\u00f1\u00edbel, redundante e escalado horizontalmente. Dous gateways NAT p\u00fablicos Os gateways NAT p\u00fablicos proporcionan acceso a Internet \u00e1s inst\u00e1ncias despregadas nas subredes privadas e impeden as conexi\u00f3ns desde Internet a esas instancias. Este tipo de gateways NAT te\u00f1en que ter un enderezo IP el\u00e1stico asociado e requiren que a VPC na que est\u00e1n, te\u00f1a asociado un gateway de Internet. Consulta a documentaci\u00f3n de AWS para saber m\u00e1is sobre a diferenza entre gateways NAT p\u00fablicos e privados. Para ter alta dispo\u00f1ibilidade, despregouse un gateway NAT p\u00fablico en cada subrede p\u00fablica. Comproba en cada gateway NAT o enderezo IP el\u00e1stico que ten asociado (a IP p\u00fablica do gateway ) e a subrede na que est\u00e1 despregado. Nota Os gateways NAT son un dos poucos compo\u00f1entes dunha VPC polos que AWS cobra. O prezo depende das horas de uso e dos GB procesados polo gateway . Imaxe: gateway NAT p\u00fablico con IP el\u00e1stica \"35.171.197.120\" na subrede \"subnet-006e26a62e4e12200/xcpm2223-subnet-public2-us-east-1b\". Imaxe: enderezos IP el\u00e1sticos asociados aos gateways NAT.","title":"Gateways"},{"location":"vpc/#taboas-de-rutas","text":"Comproba as asociaci\u00f3ns a subredes e rutas das t\u00e1boas de rutas que se crearon: A t\u00e1boa asociada \u00e1s subredes p\u00fablicas encami\u00f1a o tr\u00e1fico dirixido fora da VPC para o gateway de Internet. As t\u00e1boas asociadas \u00e1s subredes privadas encami\u00f1an o tr\u00e1fico dirixido fora da VPC para o gateway NAT da respectiva zona de dispo\u00f1ibilidade. Imaxe: t\u00e1boa de rutas asociada \u00e1s subredes p\u00fablicas. Imaxe: rutas na t\u00e1boa de rutas asociada \u00e1s subredes p\u00fablicas. Imaxe: t\u00e1boa de rutas asociada a unha subrede privada. Imaxe: rutas nunha t\u00e1boa de rutas asociada a unha subrede privada. F\u00edxate que as d\u00faas t\u00e1boas asociadas \u00e1s subredes privadas que est\u00e1n nunha mesma AZ fan o mesmo: o tr\u00e1fico dirixido fora da VPC \u00e9 encami\u00f1ado cara ao gateway NAT que est\u00e1 nesa mesma AZ. Polo tanto, como as rutas son as mesmas, podemos reducir o n\u00famero de t\u00e1boas de rutas asociadas a subredes privadas, deixando s\u00f3 unha en cada AZ. Faino da seguinte maneira: En cada AZ, escolle unha das t\u00e1boas de rutas que encami\u00f1a o tr\u00e1fico ao gateway NAT desa AZ e as\u00f3ciaa \u00e1s d\u00faas subredes privadas da AZ (a unha delas xa o estar\u00e1). Elimina a outra t\u00e1boa. Nas seguintes figuras am\u00f3sase o estado antes e despois dos trocos nunha das AZ. Imaxe: rutas das subredes privadas nunha das AZ antes dos trocos. Imaxe: rutas das subredes privadas na mesma AZ despois dos trocos.","title":"T\u00e1boas de rutas"}]}